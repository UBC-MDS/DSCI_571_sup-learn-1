

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Lectures 5: Class demo &#8212; DSCI 571 Supervised Learning 1</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" href="../../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'lectures/class_demos/05_class-demo';</script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Lectures 8: Class demo" href="08_class-demo.html" />
    <link rel="prev" title="Lecture 4: Class demo" href="04_class-demo.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="../../README.html">
  
  
  
  
    
    
      
    
    
    <img src="../../_static/mds-hex-sticker.png" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="../../_static/mds-hex-sticker.png" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Course Information</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../learning_objectives.html">Course Learning Objectives</a></li>
<li class="toctree-l1"><a class="reference internal" href="../00_motivation-course-information.html">Course Introduction</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Lectures</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../01_terminology-baselines-decision-trees.html">Lecture 1: Terminology, Baselines, Decision Trees</a></li>
<li class="toctree-l1"><a class="reference internal" href="../02_ml-fundamentals.html">Lecture 2: Machine Learning Fundamentals</a></li>
<li class="toctree-l1"><a class="reference internal" href="../03_kNNs-SVM-RBF.html">Lecture 3: <span class="math notranslate nohighlight">\(k\)</span>-Nearest Neighbours and SVM RBFs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../04_preprocessing-pipelines-column-transformer.html">Lecture 4: Preprocessing, <code class="docutils literal notranslate"><span class="pre">sklearn</span></code> Pipeline, <code class="docutils literal notranslate"><span class="pre">sklearn</span></code> ColumnTrasnsformer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../05_more-preprocessing-text-feats.html">Lecture 5: More preprocessing, text features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../06_hyperparameter-optimization.html">Lecture 6: Hyperparameter Optimization and Optimization Bias</a></li>
<li class="toctree-l1"><a class="reference internal" href="../07_naive-Bayes.html">Lecture 7: Naive Bayes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../08_linear-models.html">Lecture 8: Linear Models</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Class demos</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="02_class-demo.html">Lecture 2: Class demo</a></li>
<li class="toctree-l1"><a class="reference internal" href="03_class-demo.html">Lecture 3: Class demo</a></li>
<li class="toctree-l1"><a class="reference internal" href="04_class-demo.html">Lecture 4: Class demo</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Lectures 5: Class demo</a></li>
<li class="toctree-l1"><a class="reference internal" href="08_class-demo.html">Lectures 8: Class demo</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Attribution</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../attribution.html">Attributions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../LICENSE.html">LICENSE</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">


<a href="https://github.com/UBC-MDS/DSCI_571_sup-learn-1" target="_blank"
   class="btn btn-sm btn-source-repository-button"
   title="Source repository"
   data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>

</a>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/lectures/class_demos/05_class-demo.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Lectures 5: Class demo</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#imports-announcements-los">Imports, Announcements, LOs</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#imports">Imports</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#incorporating-text-features-in-the-spotify-dataset">Incorporating text features in the Spotify dataset</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#dummy-model">Dummy model</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#feature-categorization">Feature categorization</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#column-transformer-without-song-title-and-artist-features">Column transformer without <code class="docutils literal notranslate"><span class="pre">song_title</span></code> and <code class="docutils literal notranslate"><span class="pre">artist</span></code> features</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#visualizing-the-transformed-data">Visualizing the transformed data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#building-models">Building models</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#incorporating-song-title-feature">Incorporating “song_title” feature</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#visualizing-the-vocabulary">Visualizing the vocabulary</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#model-building">Model building</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#optional-incorporating-text-features-in-the-restaurant-survey-dataset">(Optional) Incorporating text features in the restaurant survey dataset</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#data-splitting">Data splitting</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#eda">EDA</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#dummy-classifier">Dummy Classifier</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#preprocessing">Preprocessing</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#incorporating-text-features">Incorporating text features</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="lectures-5-class-demo">
<h1>Lectures 5: Class demo<a class="headerlink" href="#lectures-5-class-demo" title="Permalink to this heading">#</a></h1>
<section id="imports-announcements-los">
<h2>Imports, Announcements, LOs<a class="headerlink" href="#imports-announcements-los" title="Permalink to this heading">#</a></h2>
<section id="imports">
<h3>Imports<a class="headerlink" href="#imports" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># import the libraries</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="s2">&quot;../&quot;</span><span class="p">),</span> <span class="s2">&quot;code&quot;</span><span class="p">))</span>
<span class="kn">from</span> <span class="nn">plotting_functions</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">utils</span> <span class="kn">import</span> <span class="o">*</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="kn">from</span> <span class="nn">sklearn.compose</span> <span class="kn">import</span> <span class="n">make_column_transformer</span>
<span class="kn">from</span> <span class="nn">sklearn.feature_extraction.text</span> <span class="kn">import</span> <span class="n">CountVectorizer</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span><span class="p">,</span> <span class="n">OneHotEncoder</span>

<span class="kn">from</span> <span class="nn">sklearn.tree</span> <span class="kn">import</span> <span class="n">DecisionTreeClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.neighbors</span> <span class="kn">import</span> <span class="n">KNeighborsClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.svm</span> <span class="kn">import</span> <span class="n">SVC</span>

<span class="o">%</span><span class="k">matplotlib</span> inline

<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s2">&quot;display.max_colwidth&quot;</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="incorporating-text-features-in-the-spotify-dataset">
<h2>Incorporating text features in the Spotify dataset<a class="headerlink" href="#incorporating-text-features-in-the-spotify-dataset" title="Permalink to this heading">#</a></h2>
<p>Recall that we had dropped <code class="docutils literal notranslate"><span class="pre">song_title</span></code> feature when we worked with the Spotify dataset in Lab 1.</p>
<p>Let’s try to include it in our pipeline and examine whether we get better results.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">spotify_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;../data/spotify.csv&quot;</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">X_spotify</span> <span class="o">=</span> <span class="n">spotify_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;target&quot;</span><span class="p">])</span>
<span class="n">y_spotify</span> <span class="o">=</span> <span class="n">spotify_df</span><span class="p">[</span><span class="s2">&quot;target&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span>
    <span class="n">X_spotify</span><span class="p">,</span> <span class="n">y_spotify</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">123</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_train</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(1613, 15)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_train</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>acousticness</th>
      <th>danceability</th>
      <th>duration_ms</th>
      <th>energy</th>
      <th>instrumentalness</th>
      <th>key</th>
      <th>liveness</th>
      <th>loudness</th>
      <th>mode</th>
      <th>speechiness</th>
      <th>tempo</th>
      <th>time_signature</th>
      <th>valence</th>
      <th>song_title</th>
      <th>artist</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1505</th>
      <td>0.004770</td>
      <td>0.585</td>
      <td>214740</td>
      <td>0.614</td>
      <td>0.000155</td>
      <td>10</td>
      <td>0.0762</td>
      <td>-5.594</td>
      <td>0</td>
      <td>0.0370</td>
      <td>114.059</td>
      <td>4.0</td>
      <td>0.2730</td>
      <td>Cool for the Summer</td>
      <td>Demi Lovato</td>
    </tr>
    <tr>
      <th>813</th>
      <td>0.114000</td>
      <td>0.665</td>
      <td>216728</td>
      <td>0.513</td>
      <td>0.303000</td>
      <td>0</td>
      <td>0.1220</td>
      <td>-7.314</td>
      <td>1</td>
      <td>0.3310</td>
      <td>100.344</td>
      <td>3.0</td>
      <td>0.0373</td>
      <td>Damn Son Where'd You Find This? (feat. Kelly Holiday) - Markus Maximus Remix</td>
      <td>Markus Maximus</td>
    </tr>
    <tr>
      <th>615</th>
      <td>0.030200</td>
      <td>0.798</td>
      <td>216585</td>
      <td>0.481</td>
      <td>0.000000</td>
      <td>7</td>
      <td>0.1280</td>
      <td>-10.488</td>
      <td>1</td>
      <td>0.3140</td>
      <td>127.136</td>
      <td>4.0</td>
      <td>0.6400</td>
      <td>Trill Hoe</td>
      <td>Western Tink</td>
    </tr>
    <tr>
      <th>319</th>
      <td>0.106000</td>
      <td>0.912</td>
      <td>194040</td>
      <td>0.317</td>
      <td>0.000208</td>
      <td>6</td>
      <td>0.0723</td>
      <td>-12.719</td>
      <td>0</td>
      <td>0.0378</td>
      <td>99.346</td>
      <td>4.0</td>
      <td>0.9490</td>
      <td>Who Is He (And What Is He to You?)</td>
      <td>Bill Withers</td>
    </tr>
    <tr>
      <th>320</th>
      <td>0.021100</td>
      <td>0.697</td>
      <td>236456</td>
      <td>0.905</td>
      <td>0.893000</td>
      <td>6</td>
      <td>0.1190</td>
      <td>-7.787</td>
      <td>0</td>
      <td>0.0339</td>
      <td>119.977</td>
      <td>4.0</td>
      <td>0.3110</td>
      <td>Acamar</td>
      <td>Frankey</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>2012</th>
      <td>0.001060</td>
      <td>0.584</td>
      <td>274404</td>
      <td>0.932</td>
      <td>0.002690</td>
      <td>1</td>
      <td>0.1290</td>
      <td>-3.501</td>
      <td>1</td>
      <td>0.3330</td>
      <td>74.976</td>
      <td>4.0</td>
      <td>0.2110</td>
      <td>Like A Bitch - Kill The Noise Remix</td>
      <td>Kill The Noise</td>
    </tr>
    <tr>
      <th>1346</th>
      <td>0.000021</td>
      <td>0.535</td>
      <td>203500</td>
      <td>0.974</td>
      <td>0.000149</td>
      <td>10</td>
      <td>0.2630</td>
      <td>-3.566</td>
      <td>0</td>
      <td>0.1720</td>
      <td>116.956</td>
      <td>4.0</td>
      <td>0.4310</td>
      <td>Flag of the Beast</td>
      <td>Emmure</td>
    </tr>
    <tr>
      <th>1406</th>
      <td>0.503000</td>
      <td>0.410</td>
      <td>256333</td>
      <td>0.648</td>
      <td>0.000000</td>
      <td>7</td>
      <td>0.2190</td>
      <td>-4.469</td>
      <td>1</td>
      <td>0.0362</td>
      <td>60.391</td>
      <td>4.0</td>
      <td>0.3420</td>
      <td>Don't You Cry For Me</td>
      <td>Cobi</td>
    </tr>
    <tr>
      <th>1389</th>
      <td>0.705000</td>
      <td>0.894</td>
      <td>222307</td>
      <td>0.161</td>
      <td>0.003300</td>
      <td>4</td>
      <td>0.3120</td>
      <td>-14.311</td>
      <td>1</td>
      <td>0.0880</td>
      <td>104.968</td>
      <td>4.0</td>
      <td>0.8180</td>
      <td>장가갈 수 있을까 Can I Get Married?</td>
      <td>Coffeeboy</td>
    </tr>
    <tr>
      <th>1534</th>
      <td>0.623000</td>
      <td>0.470</td>
      <td>394920</td>
      <td>0.156</td>
      <td>0.187000</td>
      <td>2</td>
      <td>0.1040</td>
      <td>-17.036</td>
      <td>1</td>
      <td>0.0399</td>
      <td>118.176</td>
      <td>4.0</td>
      <td>0.0591</td>
      <td>Blue Ballad</td>
      <td>Phil Woods</td>
    </tr>
  </tbody>
</table>
<p>1613 rows × 15 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_train</span><span class="o">.</span><span class="n">columns</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Index([&#39;acousticness&#39;, &#39;danceability&#39;, &#39;duration_ms&#39;, &#39;energy&#39;,
       &#39;instrumentalness&#39;, &#39;key&#39;, &#39;liveness&#39;, &#39;loudness&#39;, &#39;mode&#39;,
       &#39;speechiness&#39;, &#39;tempo&#39;, &#39;time_signature&#39;, &#39;valence&#39;, &#39;song_title&#39;,
       &#39;artist&#39;],
      dtype=&#39;object&#39;)
</pre></div>
</div>
</div>
</div>
<section id="dummy-model">
<h3>Dummy model<a class="headerlink" href="#dummy-model" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.dummy</span> <span class="kn">import</span> <span class="n">DummyClassifier</span>

<span class="n">results</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">dummy_model</span> <span class="o">=</span> <span class="n">DummyClassifier</span><span class="p">()</span>
<span class="c1"># mean_std_cross_val_scores is defined in ../code/utils.py</span>
<span class="n">results</span><span class="p">[</span><span class="s1">&#39;dummy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mean_std_cross_val_scores</span><span class="p">(</span><span class="n">dummy_model</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">return_train_score</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> 
<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>dummy</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>fit_time</th>
      <td>0.000 (+/- 0.000)</td>
    </tr>
    <tr>
      <th>score_time</th>
      <td>0.000 (+/- 0.000)</td>
    </tr>
    <tr>
      <th>test_score</th>
      <td>0.508 (+/- 0.001)</td>
    </tr>
    <tr>
      <th>train_score</th>
      <td>0.508 (+/- 0.000)</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="feature-categorization">
<h3>Feature categorization<a class="headerlink" href="#feature-categorization" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_train</span><span class="o">.</span><span class="n">columns</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Index([&#39;acousticness&#39;, &#39;danceability&#39;, &#39;duration_ms&#39;, &#39;energy&#39;,
       &#39;instrumentalness&#39;, &#39;key&#39;, &#39;liveness&#39;, &#39;loudness&#39;, &#39;mode&#39;,
       &#39;speechiness&#39;, &#39;tempo&#39;, &#39;time_signature&#39;, &#39;valence&#39;, &#39;song_title&#39;,
       &#39;artist&#39;],
      dtype=&#39;object&#39;)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_train</span><span class="p">[</span><span class="s2">&quot;key&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>key
1     200
7     169
0     166
9     152
2     145
11    143
5     141
6     127
10    122
8     110
4      88
3      50
Name: count, dtype: int64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_train</span><span class="p">[</span><span class="s2">&quot;time_signature&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>time_signature
4.0    1514
3.0      76
5.0      22
1.0       1
Name: count, dtype: int64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_train</span><span class="p">[</span><span class="s2">&quot;mode&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>mode
1    1002
0     611
Name: count, dtype: int64
</pre></div>
</div>
</div>
</div>
<p>Let’s look at the distribution of values in the <code class="docutils literal notranslate"><span class="pre">song_title</span></code> column.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_train</span><span class="p">[</span><span class="s2">&quot;song_title&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>song_title
Pyramids                                     2
Look At Wrist                                2
Baby                                         2
The One                                      2
Best Friend                                  2
                                            ..
City Of Dreams - Radio Edit                  1
Face It                                      1
The Winner Is - from Little Miss Sunshine    1
History                                      1
Blue Ballad                                  1
Name: count, Length: 1579, dtype: int64
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Most of the song titles are unique, which makes sense.</p></li>
<li><p>What would happen if we apply one-hot encoding to this feature?</p></li>
<li><p>How about encoding this as a text feature?</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_train</span><span class="p">[</span><span class="s2">&quot;artist&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>artist
Drake              14
Disclosure         12
Rick Ross          11
WALK THE MOON      10
Crystal Castles     8
                   ..
Classixx            1
Jordan Feliz        1
Travis Hayes        1
The Silvertones     1
Phil Woods          1
Name: count, Length: 1131, dtype: int64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">numeric_feats</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;acousticness&#39;</span><span class="p">,</span> <span class="s1">&#39;danceability&#39;</span><span class="p">,</span> <span class="s1">&#39;energy&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;instrumentalness&#39;</span><span class="p">,</span> <span class="s1">&#39;liveness&#39;</span><span class="p">,</span> <span class="s1">&#39;loudness&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;speechiness&#39;</span><span class="p">,</span> <span class="s1">&#39;tempo&#39;</span><span class="p">,</span> <span class="s1">&#39;valence&#39;</span><span class="p">]</span>
<span class="n">categorical_feats</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;time_signature&#39;</span><span class="p">,</span> <span class="s1">&#39;key&#39;</span><span class="p">]</span>
<span class="n">passthrough_feats</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;mode&#39;</span><span class="p">]</span>
<span class="n">artist_cat_feat</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;artist&#39;</span><span class="p">]</span>
<span class="n">text_feat</span> <span class="o">=</span> <span class="s1">&#39;song_title&#39;</span> <span class="c1"># Define the text feature</span>
</pre></div>
</div>
</div>
</div>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Note that unlike other feature types we are defining <code class="docutils literal notranslate"><span class="pre">text_feature</span></code> as a string and not as a list.</p>
</div>
</section>
<section id="column-transformer-without-song-title-and-artist-features">
<h3>Column transformer without <code class="docutils literal notranslate"><span class="pre">song_title</span></code> and <code class="docutils literal notranslate"><span class="pre">artist</span></code> features<a class="headerlink" href="#column-transformer-without-song-title-and-artist-features" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">preprocessor_no_text</span> <span class="o">=</span> <span class="n">make_column_transformer</span><span class="p">(</span>
    <span class="p">(</span><span class="n">StandardScaler</span><span class="p">(),</span> <span class="n">numeric_feats</span><span class="p">),</span> 
    <span class="p">(</span><span class="s2">&quot;passthrough&quot;</span><span class="p">,</span> <span class="n">passthrough_feats</span><span class="p">),</span>     
    <span class="p">(</span><span class="n">OneHotEncoder</span><span class="p">(</span><span class="n">handle_unknown</span> <span class="o">=</span> <span class="s2">&quot;ignore&quot;</span><span class="p">),</span> <span class="n">categorical_feats</span><span class="p">),</span>     
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="visualizing-the-transformed-data">
<h3>Visualizing the transformed data<a class="headerlink" href="#visualizing-the-transformed-data" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">transformed_no_text</span> <span class="o">=</span> <span class="n">preprocessor_no_text</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
<span class="n">transformed_no_text</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(1613, 26)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">preprocessor_no_text</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style>#sk-container-id-1 {color: black;}#sk-container-id-1 pre{padding: 0;}#sk-container-id-1 div.sk-toggleable {background-color: white;}#sk-container-id-1 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-container-id-1 label.sk-toggleable__label-arrow:before {content: "▸";float: left;margin-right: 0.25em;color: #696969;}#sk-container-id-1 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-container-id-1 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-container-id-1 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-container-id-1 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-container-id-1 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-container-id-1 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "▾";}#sk-container-id-1 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-1 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-1 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-container-id-1 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-container-id-1 div.sk-estimator:hover {background-color: #d4ebff;}#sk-container-id-1 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-container-id-1 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-1 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: 0;}#sk-container-id-1 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;position: relative;}#sk-container-id-1 div.sk-item {position: relative;z-index: 1;}#sk-container-id-1 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;position: relative;}#sk-container-id-1 div.sk-item::before, #sk-container-id-1 div.sk-parallel-item::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: -1;}#sk-container-id-1 div.sk-parallel-item {display: flex;flex-direction: column;z-index: 1;position: relative;background-color: white;}#sk-container-id-1 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-container-id-1 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-container-id-1 div.sk-parallel-item:only-child::after {width: 0;}#sk-container-id-1 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;}#sk-container-id-1 div.sk-label label {font-family: monospace;font-weight: bold;display: inline-block;line-height: 1.2em;}#sk-container-id-1 div.sk-label-container {text-align: center;}#sk-container-id-1 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-container-id-1 div.sk-text-repr-fallback {display: none;}</style><div id="sk-container-id-1" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>ColumnTransformer(transformers=[(&#x27;standardscaler&#x27;, StandardScaler(),
                                 [&#x27;acousticness&#x27;, &#x27;danceability&#x27;, &#x27;energy&#x27;,
                                  &#x27;instrumentalness&#x27;, &#x27;liveness&#x27;, &#x27;loudness&#x27;,
                                  &#x27;speechiness&#x27;, &#x27;tempo&#x27;, &#x27;valence&#x27;]),
                                (&#x27;passthrough&#x27;, &#x27;passthrough&#x27;, [&#x27;mode&#x27;]),
                                (&#x27;onehotencoder&#x27;,
                                 OneHotEncoder(handle_unknown=&#x27;ignore&#x27;),
                                 [&#x27;time_signature&#x27;, &#x27;key&#x27;])])</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-1" type="checkbox" ><label for="sk-estimator-id-1" class="sk-toggleable__label sk-toggleable__label-arrow">ColumnTransformer</label><div class="sk-toggleable__content"><pre>ColumnTransformer(transformers=[(&#x27;standardscaler&#x27;, StandardScaler(),
                                 [&#x27;acousticness&#x27;, &#x27;danceability&#x27;, &#x27;energy&#x27;,
                                  &#x27;instrumentalness&#x27;, &#x27;liveness&#x27;, &#x27;loudness&#x27;,
                                  &#x27;speechiness&#x27;, &#x27;tempo&#x27;, &#x27;valence&#x27;]),
                                (&#x27;passthrough&#x27;, &#x27;passthrough&#x27;, [&#x27;mode&#x27;]),
                                (&#x27;onehotencoder&#x27;,
                                 OneHotEncoder(handle_unknown=&#x27;ignore&#x27;),
                                 [&#x27;time_signature&#x27;, &#x27;key&#x27;])])</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-2" type="checkbox" ><label for="sk-estimator-id-2" class="sk-toggleable__label sk-toggleable__label-arrow">standardscaler</label><div class="sk-toggleable__content"><pre>[&#x27;acousticness&#x27;, &#x27;danceability&#x27;, &#x27;energy&#x27;, &#x27;instrumentalness&#x27;, &#x27;liveness&#x27;, &#x27;loudness&#x27;, &#x27;speechiness&#x27;, &#x27;tempo&#x27;, &#x27;valence&#x27;]</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-3" type="checkbox" ><label for="sk-estimator-id-3" class="sk-toggleable__label sk-toggleable__label-arrow">StandardScaler</label><div class="sk-toggleable__content"><pre>StandardScaler()</pre></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-4" type="checkbox" ><label for="sk-estimator-id-4" class="sk-toggleable__label sk-toggleable__label-arrow">passthrough</label><div class="sk-toggleable__content"><pre>[&#x27;mode&#x27;]</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-5" type="checkbox" ><label for="sk-estimator-id-5" class="sk-toggleable__label sk-toggleable__label-arrow">passthrough</label><div class="sk-toggleable__content"><pre>passthrough</pre></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-6" type="checkbox" ><label for="sk-estimator-id-6" class="sk-toggleable__label sk-toggleable__label-arrow">onehotencoder</label><div class="sk-toggleable__content"><pre>[&#x27;time_signature&#x27;, &#x27;key&#x27;]</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-7" type="checkbox" ><label for="sk-estimator-id-7" class="sk-toggleable__label sk-toggleable__label-arrow">OneHotEncoder</label><div class="sk-toggleable__content"><pre>OneHotEncoder(handle_unknown=&#x27;ignore&#x27;)</pre></div></div></div></div></div></div></div></div></div></div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ohe_feat_names</span> <span class="o">=</span> <span class="n">preprocessor_no_text</span><span class="o">.</span><span class="n">named_transformers_</span><span class="p">[</span><span class="s2">&quot;onehotencoder&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get_feature_names_out</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="n">ohe_feat_names</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;time_signature_1.0&#39;,
 &#39;time_signature_3.0&#39;,
 &#39;time_signature_4.0&#39;,
 &#39;time_signature_5.0&#39;,
 &#39;key_0&#39;,
 &#39;key_1&#39;,
 &#39;key_2&#39;,
 &#39;key_3&#39;,
 &#39;key_4&#39;,
 &#39;key_5&#39;,
 &#39;key_6&#39;,
 &#39;key_7&#39;,
 &#39;key_8&#39;,
 &#39;key_9&#39;,
 &#39;key_10&#39;,
 &#39;key_11&#39;]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">feat_names</span> <span class="o">=</span> <span class="n">numeric_feats</span> <span class="o">+</span> <span class="n">passthrough_feats</span> <span class="o">+</span> <span class="n">ohe_feat_names</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">transformed_no_text</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">feat_names</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>acousticness</th>
      <th>danceability</th>
      <th>energy</th>
      <th>instrumentalness</th>
      <th>liveness</th>
      <th>loudness</th>
      <th>speechiness</th>
      <th>tempo</th>
      <th>valence</th>
      <th>mode</th>
      <th>...</th>
      <th>key_2</th>
      <th>key_3</th>
      <th>key_4</th>
      <th>key_5</th>
      <th>key_6</th>
      <th>key_7</th>
      <th>key_8</th>
      <th>key_9</th>
      <th>key_10</th>
      <th>key_11</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>-0.697633</td>
      <td>-0.194548</td>
      <td>-0.318116</td>
      <td>-0.492359</td>
      <td>-0.737898</td>
      <td>0.395794</td>
      <td>-0.617752</td>
      <td>-0.293827</td>
      <td>-0.908149</td>
      <td>0.0</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>-0.276291</td>
      <td>0.295726</td>
      <td>-0.795552</td>
      <td>0.598355</td>
      <td>-0.438792</td>
      <td>-0.052394</td>
      <td>2.728394</td>
      <td>-0.802595</td>
      <td>-1.861238</td>
      <td>1.0</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>-0.599540</td>
      <td>1.110806</td>
      <td>-0.946819</td>
      <td>-0.492917</td>
      <td>-0.399607</td>
      <td>-0.879457</td>
      <td>2.534909</td>
      <td>0.191274</td>
      <td>0.575870</td>
      <td>1.0</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>-0.307150</td>
      <td>1.809445</td>
      <td>-1.722063</td>
      <td>-0.492168</td>
      <td>-0.763368</td>
      <td>-1.460798</td>
      <td>-0.608647</td>
      <td>-0.839616</td>
      <td>1.825358</td>
      <td>0.0</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>-0.634642</td>
      <td>0.491835</td>
      <td>1.057468</td>
      <td>2.723273</td>
      <td>-0.458384</td>
      <td>-0.175645</td>
      <td>-0.653035</td>
      <td>-0.074294</td>
      <td>-0.754491</td>
      <td>0.0</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>1608</th>
      <td>-0.711944</td>
      <td>-0.200676</td>
      <td>1.185100</td>
      <td>-0.483229</td>
      <td>-0.393077</td>
      <td>0.941176</td>
      <td>2.751157</td>
      <td>-1.743639</td>
      <td>-1.158856</td>
      <td>1.0</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1609</th>
      <td>-0.715953</td>
      <td>-0.500969</td>
      <td>1.383637</td>
      <td>-0.492380</td>
      <td>0.482038</td>
      <td>0.924239</td>
      <td>0.918743</td>
      <td>-0.186361</td>
      <td>-0.269253</td>
      <td>0.0</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1610</th>
      <td>1.224228</td>
      <td>-1.267021</td>
      <td>-0.157395</td>
      <td>-0.492917</td>
      <td>0.194687</td>
      <td>0.688940</td>
      <td>-0.626857</td>
      <td>-2.284681</td>
      <td>-0.629138</td>
      <td>1.0</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1611</th>
      <td>2.003419</td>
      <td>1.699134</td>
      <td>-2.459489</td>
      <td>-0.481032</td>
      <td>0.802042</td>
      <td>-1.875632</td>
      <td>-0.037298</td>
      <td>-0.631064</td>
      <td>1.295640</td>
      <td>1.0</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1612</th>
      <td>1.687114</td>
      <td>-0.899316</td>
      <td>-2.483125</td>
      <td>0.180574</td>
      <td>-0.556344</td>
      <td>-2.585697</td>
      <td>-0.584746</td>
      <td>-0.141104</td>
      <td>-1.773086</td>
      <td>1.0</td>
      <td>...</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
<p>1613 rows × 26 columns</p>
</div></div></div>
</div>
</section>
<section id="building-models">
<h3>Building models<a class="headerlink" href="#building-models" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">models</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;Decision Tree&quot;</span><span class="p">:</span> <span class="n">DecisionTreeClassifier</span><span class="p">(),</span>
    <span class="s2">&quot;KNN&quot;</span><span class="p">:</span> <span class="n">KNeighborsClassifier</span><span class="p">(),</span>
    <span class="s2">&quot;SVM&quot;</span><span class="p">:</span> <span class="n">SVC</span><span class="p">()</span>    
<span class="p">}</span>

<span class="k">for</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span> <span class="ow">in</span> <span class="n">models</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">pipe_model</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">preprocessor_no_text</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span>
    <span class="n">results</span><span class="p">[</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot; (no_text)&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mean_std_cross_val_scores</span><span class="p">(</span><span class="n">pipe_model</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">return_train_score</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>fit_time</th>
      <th>score_time</th>
      <th>test_score</th>
      <th>train_score</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>dummy</th>
      <td>0.000 (+/- 0.000)</td>
      <td>0.000 (+/- 0.000)</td>
      <td>0.508 (+/- 0.001)</td>
      <td>0.508 (+/- 0.000)</td>
    </tr>
    <tr>
      <th>Decision Tree (no_text)</th>
      <td>0.016 (+/- 0.000)</td>
      <td>0.003 (+/- 0.000)</td>
      <td>0.688 (+/- 0.023)</td>
      <td>1.000 (+/- 0.000)</td>
    </tr>
    <tr>
      <th>KNN (no_text)</th>
      <td>0.005 (+/- 0.001)</td>
      <td>0.015 (+/- 0.020)</td>
      <td>0.676 (+/- 0.028)</td>
      <td>0.788 (+/- 0.009)</td>
    </tr>
    <tr>
      <th>SVM (no_text)</th>
      <td>0.054 (+/- 0.004)</td>
      <td>0.021 (+/- 0.001)</td>
      <td>0.737 (+/- 0.017)</td>
      <td>0.806 (+/- 0.011)</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p><br><br></p>
</section>
<section id="incorporating-song-title-feature">
<h3>Incorporating “song_title” feature<a class="headerlink" href="#incorporating-song-title-feature" title="Permalink to this heading">#</a></h3>
<p>Let’s incorporate bag-of-words representation of “song_title” feature in our column transformer.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">numeric_feats</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;acousticness&#39;,
 &#39;danceability&#39;,
 &#39;energy&#39;,
 &#39;instrumentalness&#39;,
 &#39;liveness&#39;,
 &#39;loudness&#39;,
 &#39;speechiness&#39;,
 &#39;tempo&#39;,
 &#39;valence&#39;]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">text_feat</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;song_title&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">preprocessor</span> <span class="o">=</span> <span class="n">make_column_transformer</span><span class="p">(</span>
    <span class="p">(</span><span class="n">StandardScaler</span><span class="p">(),</span> <span class="n">numeric_feats</span><span class="p">),</span> 
    <span class="p">(</span><span class="s2">&quot;passthrough&quot;</span><span class="p">,</span> <span class="n">passthrough_feats</span><span class="p">),</span>     
    <span class="p">(</span><span class="n">OneHotEncoder</span><span class="p">(</span><span class="n">handle_unknown</span> <span class="o">=</span> <span class="s2">&quot;ignore&quot;</span><span class="p">),</span> <span class="n">categorical_feats</span><span class="p">),</span>     
    <span class="p">(</span><span class="n">CountVectorizer</span><span class="p">(</span><span class="n">stop_words</span><span class="o">=</span><span class="s2">&quot;english&quot;</span><span class="p">),</span> <span class="n">text_feat</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Transform the data</span>
<span class="n">transformed</span> <span class="o">=</span> <span class="n">preprocessor</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">preprocessor</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style>#sk-container-id-2 {color: black;}#sk-container-id-2 pre{padding: 0;}#sk-container-id-2 div.sk-toggleable {background-color: white;}#sk-container-id-2 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-container-id-2 label.sk-toggleable__label-arrow:before {content: "▸";float: left;margin-right: 0.25em;color: #696969;}#sk-container-id-2 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-container-id-2 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-container-id-2 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-container-id-2 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-container-id-2 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-container-id-2 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "▾";}#sk-container-id-2 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-2 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-2 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-container-id-2 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-container-id-2 div.sk-estimator:hover {background-color: #d4ebff;}#sk-container-id-2 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-container-id-2 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-2 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: 0;}#sk-container-id-2 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;position: relative;}#sk-container-id-2 div.sk-item {position: relative;z-index: 1;}#sk-container-id-2 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;position: relative;}#sk-container-id-2 div.sk-item::before, #sk-container-id-2 div.sk-parallel-item::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: -1;}#sk-container-id-2 div.sk-parallel-item {display: flex;flex-direction: column;z-index: 1;position: relative;background-color: white;}#sk-container-id-2 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-container-id-2 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-container-id-2 div.sk-parallel-item:only-child::after {width: 0;}#sk-container-id-2 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;}#sk-container-id-2 div.sk-label label {font-family: monospace;font-weight: bold;display: inline-block;line-height: 1.2em;}#sk-container-id-2 div.sk-label-container {text-align: center;}#sk-container-id-2 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-container-id-2 div.sk-text-repr-fallback {display: none;}</style><div id="sk-container-id-2" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>ColumnTransformer(transformers=[(&#x27;standardscaler&#x27;, StandardScaler(),
                                 [&#x27;acousticness&#x27;, &#x27;danceability&#x27;, &#x27;energy&#x27;,
                                  &#x27;instrumentalness&#x27;, &#x27;liveness&#x27;, &#x27;loudness&#x27;,
                                  &#x27;speechiness&#x27;, &#x27;tempo&#x27;, &#x27;valence&#x27;]),
                                (&#x27;passthrough&#x27;, &#x27;passthrough&#x27;, [&#x27;mode&#x27;]),
                                (&#x27;onehotencoder&#x27;,
                                 OneHotEncoder(handle_unknown=&#x27;ignore&#x27;),
                                 [&#x27;time_signature&#x27;, &#x27;key&#x27;]),
                                (&#x27;countvectorizer&#x27;,
                                 CountVectorizer(stop_words=&#x27;english&#x27;),
                                 &#x27;song_title&#x27;)])</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-8" type="checkbox" ><label for="sk-estimator-id-8" class="sk-toggleable__label sk-toggleable__label-arrow">ColumnTransformer</label><div class="sk-toggleable__content"><pre>ColumnTransformer(transformers=[(&#x27;standardscaler&#x27;, StandardScaler(),
                                 [&#x27;acousticness&#x27;, &#x27;danceability&#x27;, &#x27;energy&#x27;,
                                  &#x27;instrumentalness&#x27;, &#x27;liveness&#x27;, &#x27;loudness&#x27;,
                                  &#x27;speechiness&#x27;, &#x27;tempo&#x27;, &#x27;valence&#x27;]),
                                (&#x27;passthrough&#x27;, &#x27;passthrough&#x27;, [&#x27;mode&#x27;]),
                                (&#x27;onehotencoder&#x27;,
                                 OneHotEncoder(handle_unknown=&#x27;ignore&#x27;),
                                 [&#x27;time_signature&#x27;, &#x27;key&#x27;]),
                                (&#x27;countvectorizer&#x27;,
                                 CountVectorizer(stop_words=&#x27;english&#x27;),
                                 &#x27;song_title&#x27;)])</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-9" type="checkbox" ><label for="sk-estimator-id-9" class="sk-toggleable__label sk-toggleable__label-arrow">standardscaler</label><div class="sk-toggleable__content"><pre>[&#x27;acousticness&#x27;, &#x27;danceability&#x27;, &#x27;energy&#x27;, &#x27;instrumentalness&#x27;, &#x27;liveness&#x27;, &#x27;loudness&#x27;, &#x27;speechiness&#x27;, &#x27;tempo&#x27;, &#x27;valence&#x27;]</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-10" type="checkbox" ><label for="sk-estimator-id-10" class="sk-toggleable__label sk-toggleable__label-arrow">StandardScaler</label><div class="sk-toggleable__content"><pre>StandardScaler()</pre></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-11" type="checkbox" ><label for="sk-estimator-id-11" class="sk-toggleable__label sk-toggleable__label-arrow">passthrough</label><div class="sk-toggleable__content"><pre>[&#x27;mode&#x27;]</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-12" type="checkbox" ><label for="sk-estimator-id-12" class="sk-toggleable__label sk-toggleable__label-arrow">passthrough</label><div class="sk-toggleable__content"><pre>passthrough</pre></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-13" type="checkbox" ><label for="sk-estimator-id-13" class="sk-toggleable__label sk-toggleable__label-arrow">onehotencoder</label><div class="sk-toggleable__content"><pre>[&#x27;time_signature&#x27;, &#x27;key&#x27;]</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-14" type="checkbox" ><label for="sk-estimator-id-14" class="sk-toggleable__label sk-toggleable__label-arrow">OneHotEncoder</label><div class="sk-toggleable__content"><pre>OneHotEncoder(handle_unknown=&#x27;ignore&#x27;)</pre></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-15" type="checkbox" ><label for="sk-estimator-id-15" class="sk-toggleable__label sk-toggleable__label-arrow">countvectorizer</label><div class="sk-toggleable__content"><pre>song_title</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-16" type="checkbox" ><label for="sk-estimator-id-16" class="sk-toggleable__label sk-toggleable__label-arrow">CountVectorizer</label><div class="sk-toggleable__content"><pre>CountVectorizer(stop_words=&#x27;english&#x27;)</pre></div></div></div></div></div></div></div></div></div></div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get the vocabulary</span>
<span class="n">vocab</span> <span class="o">=</span> <span class="n">preprocessor</span><span class="o">.</span><span class="n">named_transformers_</span><span class="p">[</span><span class="s1">&#39;countvectorizer&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_feature_names_out</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">column_names</span> <span class="o">=</span> <span class="n">numeric_feats</span> <span class="o">+</span> <span class="n">passthrough_feats</span> <span class="o">+</span> <span class="n">ohe_feat_names</span> <span class="o">+</span> <span class="n">vocab</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="nb">len</span><span class="p">(</span><span class="n">column_names</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1910
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">transformed</span><span class="o">.</span><span class="n">toarray</span><span class="p">(),</span> <span class="n">columns</span><span class="o">=</span><span class="n">column_names</span><span class="p">)</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>acousticness</th>
      <th>danceability</th>
      <th>energy</th>
      <th>instrumentalness</th>
      <th>liveness</th>
      <th>loudness</th>
      <th>speechiness</th>
      <th>tempo</th>
      <th>valence</th>
      <th>mode</th>
      <th>...</th>
      <th>너와의</th>
      <th>루시아</th>
      <th>변명</th>
      <th>여기</th>
      <th>이곳에서</th>
      <th>이대로</th>
      <th>있어줘요</th>
      <th>있을까</th>
      <th>장가갈</th>
      <th>지금</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>-0.697633</td>
      <td>-0.194548</td>
      <td>-0.318116</td>
      <td>-0.492359</td>
      <td>-0.737898</td>
      <td>0.395794</td>
      <td>-0.617752</td>
      <td>-0.293827</td>
      <td>-0.908149</td>
      <td>0.0</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>-0.276291</td>
      <td>0.295726</td>
      <td>-0.795552</td>
      <td>0.598355</td>
      <td>-0.438792</td>
      <td>-0.052394</td>
      <td>2.728394</td>
      <td>-0.802595</td>
      <td>-1.861238</td>
      <td>1.0</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>-0.599540</td>
      <td>1.110806</td>
      <td>-0.946819</td>
      <td>-0.492917</td>
      <td>-0.399607</td>
      <td>-0.879457</td>
      <td>2.534909</td>
      <td>0.191274</td>
      <td>0.575870</td>
      <td>1.0</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>-0.307150</td>
      <td>1.809445</td>
      <td>-1.722063</td>
      <td>-0.492168</td>
      <td>-0.763368</td>
      <td>-1.460798</td>
      <td>-0.608647</td>
      <td>-0.839616</td>
      <td>1.825358</td>
      <td>0.0</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>-0.634642</td>
      <td>0.491835</td>
      <td>1.057468</td>
      <td>2.723273</td>
      <td>-0.458384</td>
      <td>-0.175645</td>
      <td>-0.653035</td>
      <td>-0.074294</td>
      <td>-0.754491</td>
      <td>0.0</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>1608</th>
      <td>-0.711944</td>
      <td>-0.200676</td>
      <td>1.185100</td>
      <td>-0.483229</td>
      <td>-0.393077</td>
      <td>0.941176</td>
      <td>2.751157</td>
      <td>-1.743639</td>
      <td>-1.158856</td>
      <td>1.0</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1609</th>
      <td>-0.715953</td>
      <td>-0.500969</td>
      <td>1.383637</td>
      <td>-0.492380</td>
      <td>0.482038</td>
      <td>0.924239</td>
      <td>0.918743</td>
      <td>-0.186361</td>
      <td>-0.269253</td>
      <td>0.0</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1610</th>
      <td>1.224228</td>
      <td>-1.267021</td>
      <td>-0.157395</td>
      <td>-0.492917</td>
      <td>0.194687</td>
      <td>0.688940</td>
      <td>-0.626857</td>
      <td>-2.284681</td>
      <td>-0.629138</td>
      <td>1.0</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1611</th>
      <td>2.003419</td>
      <td>1.699134</td>
      <td>-2.459489</td>
      <td>-0.481032</td>
      <td>0.802042</td>
      <td>-1.875632</td>
      <td>-0.037298</td>
      <td>-0.631064</td>
      <td>1.295640</td>
      <td>1.0</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1612</th>
      <td>1.687114</td>
      <td>-0.899316</td>
      <td>-2.483125</td>
      <td>0.180574</td>
      <td>-0.556344</td>
      <td>-2.585697</td>
      <td>-0.584746</td>
      <td>-0.141104</td>
      <td>-1.773086</td>
      <td>1.0</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
<p>1613 rows × 1910 columns</p>
</div></div></div>
</div>
</section>
<section id="visualizing-the-vocabulary">
<h3>Visualizing the vocabulary<a class="headerlink" href="#visualizing-the-vocabulary" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">vocab</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">10</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([&#39;000&#39;, &#39;10&#39;, &#39;100&#39;, &#39;10cm&#39;, &#39;11&#39;, &#39;112&#39;, &#39;12&#39;, &#39;1208&#39;, &#39;144&#39;, &#39;18&#39;],
      dtype=object)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">vocab</span><span class="p">[</span><span class="mi">500</span><span class="p">:</span><span class="mi">510</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([&#39;duele&#39;, &#39;duet&#39;, &#39;duke&#39;, &#39;dustland&#39;, &#39;dutchie&#39;, &#39;dynamite&#39;,
       &#39;earth&#39;, &#39;easy&#39;, &#39;eazy&#39;, &#39;echelon&#39;], dtype=object)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">vocab</span><span class="p">[</span><span class="mi">1800</span><span class="p">:</span><span class="mi">1810</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([&#39;wide&#39;, &#39;wifey&#39;, &#39;wild&#39;, &#39;wildcard&#39;, &#39;wildfire&#39;, &#39;wiley&#39;,
       &#39;willing&#39;, &#39;win&#39;, &#39;wind&#39;, &#39;window&#39;], dtype=object)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">vocab</span><span class="p">[</span><span class="mi">0</span><span class="p">::</span><span class="mi">100</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([&#39;000&#39;, &#39;ap&#39;, &#39;blind&#39;, &#39;cha&#39;, &#39;dallask&#39;, &#39;duele&#39;, &#39;flashlight&#39;,
       &#39;grace&#39;, &#39;icarus&#39;, &#39;lafa&#39;, &#39;making&#39;, &#39;neck&#39;, &#39;pharaohs&#39;, &#39;redeem&#39;,
       &#39;seeb&#39;, &#39;soundtrack&#39;, &#39;talons&#39;, &#39;unanswered&#39;, &#39;wide&#39;], dtype=object)
</pre></div>
</div>
</div>
</div>
<p>Let’s find songs containing the word <em>earth</em> in them.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">earth_index_vocab</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">vocab</span> <span class="o">==</span> <span class="s2">&quot;earth&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<span class="n">earth_index_vocab</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>506
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">earth_index_in_df</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">numeric_feats</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">passthrough_feats</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">ohe_feat_names</span><span class="p">)</span> <span class="o">+</span> <span class="n">earth_index_vocab</span>
<span class="n">earth_index_in_df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>532
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">earth_songs</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="n">earth_index_in_df</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span>
<span class="n">earth_songs</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="n">earth_index_in_df</span> <span class="o">-</span> <span class="mi">2</span> <span class="p">:</span> <span class="n">earth_index_in_df</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>dutchie</th>
      <th>dynamite</th>
      <th>earth</th>
      <th>easy</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>380</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>639</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">earth_songs</span><span class="o">.</span><span class="n">index</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Index([380, 639], dtype=&#39;int64&#39;)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_train</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">earth_songs</span><span class="o">.</span><span class="n">index</span><span class="p">][</span><span class="s2">&quot;song_title&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1851             Softest Place On Earth
1948    Earth Song - Remastered Version
Name: song_title, dtype: object
</pre></div>
</div>
</div>
</div>
</section>
<section id="model-building">
<h3>Model building<a class="headerlink" href="#model-building" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">models</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;Decision Tree&quot;</span><span class="p">:</span> <span class="n">DecisionTreeClassifier</span><span class="p">(),</span>
    <span class="s2">&quot;KNN&quot;</span><span class="p">:</span> <span class="n">KNeighborsClassifier</span><span class="p">(),</span>
    <span class="s2">&quot;SVM&quot;</span><span class="p">:</span> <span class="n">SVC</span><span class="p">()</span>    
<span class="p">}</span>

<span class="k">for</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span> <span class="ow">in</span> <span class="n">models</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">pipe_model</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">preprocessor</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span>
    <span class="n">results</span><span class="p">[</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot; (text)&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mean_std_cross_val_scores</span><span class="p">(</span><span class="n">pipe_model</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">return_train_score</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>fit_time</th>
      <th>score_time</th>
      <th>test_score</th>
      <th>train_score</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>dummy</th>
      <td>0.000 (+/- 0.000)</td>
      <td>0.000 (+/- 0.000)</td>
      <td>0.508 (+/- 0.001)</td>
      <td>0.508 (+/- 0.000)</td>
    </tr>
    <tr>
      <th>Decision Tree (no_text)</th>
      <td>0.016 (+/- 0.000)</td>
      <td>0.003 (+/- 0.000)</td>
      <td>0.688 (+/- 0.023)</td>
      <td>1.000 (+/- 0.000)</td>
    </tr>
    <tr>
      <th>KNN (no_text)</th>
      <td>0.005 (+/- 0.001)</td>
      <td>0.015 (+/- 0.020)</td>
      <td>0.676 (+/- 0.028)</td>
      <td>0.788 (+/- 0.009)</td>
    </tr>
    <tr>
      <th>SVM (no_text)</th>
      <td>0.054 (+/- 0.004)</td>
      <td>0.021 (+/- 0.001)</td>
      <td>0.737 (+/- 0.017)</td>
      <td>0.806 (+/- 0.011)</td>
    </tr>
    <tr>
      <th>Decision Tree (text)</th>
      <td>0.035 (+/- 0.002)</td>
      <td>0.005 (+/- 0.001)</td>
      <td>0.700 (+/- 0.027)</td>
      <td>1.000 (+/- 0.000)</td>
    </tr>
    <tr>
      <th>KNN (text)</th>
      <td>0.012 (+/- 0.002)</td>
      <td>0.031 (+/- 0.004)</td>
      <td>0.682 (+/- 0.028)</td>
      <td>0.786 (+/- 0.010)</td>
    </tr>
    <tr>
      <th>SVM (text)</th>
      <td>0.059 (+/- 0.003)</td>
      <td>0.014 (+/- 0.001)</td>
      <td>0.733 (+/- 0.027)</td>
      <td>0.866 (+/- 0.004)</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<ul class="simple">
<li><p>Not a big difference in the results.</p></li>
<li><p>Seems like there is more overfitting when we included the <code class="docutils literal notranslate"><span class="pre">song_title</span></code> feature.</p></li>
<li><p>The training score of SVC is much higher when we include all features. Hyperparameter optimization of <code class="docutils literal notranslate"><span class="pre">C</span></code> and <code class="docutils literal notranslate"><span class="pre">gamma</span></code> may help.</p></li>
</ul>
<ul class="simple">
<li><p>What about the <code class="docutils literal notranslate"><span class="pre">artist</span></code> column?</p></li>
<li><p>Does it make sense to apply BOW encoding to it?</p></li>
<li><p>Let’s look at the distribution of values in the <code class="docutils literal notranslate"><span class="pre">artist</span></code> column.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_train</span><span class="p">[</span><span class="s1">&#39;artist&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>artist
Drake              14
Disclosure         12
Rick Ross          11
WALK THE MOON      10
Crystal Castles     8
                   ..
Classixx            1
Jordan Feliz        1
Travis Hayes        1
The Silvertones     1
Phil Woods          1
Name: count, Length: 1131, dtype: int64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">most_frequent</span> <span class="o">=</span> <span class="n">X_train</span><span class="p">[</span><span class="s2">&quot;artist&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="mi">15</span><span class="p">]</span>
<span class="n">most_frequent</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>artist
Drake              14
Disclosure         12
Rick Ross          11
WALK THE MOON      10
Crystal Castles     8
Big Time Rush       8
FIDLAR              8
Fall Out Boy        8
Demi Lovato         7
Kanye West          7
Kina Grannis        7
Backstreet Boys     7
Beach House         6
Young Thug          6
*NSYNC              6
Name: count, dtype: int64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">preprocessor_artist</span> <span class="o">=</span> <span class="n">make_column_transformer</span><span class="p">(</span>
    <span class="p">(</span><span class="n">StandardScaler</span><span class="p">(),</span> <span class="n">numeric_feats</span><span class="p">),</span> 
    <span class="p">(</span><span class="s2">&quot;passthrough&quot;</span><span class="p">,</span> <span class="n">passthrough_feats</span><span class="p">),</span>     
    <span class="p">(</span><span class="n">OneHotEncoder</span><span class="p">(</span><span class="n">handle_unknown</span> <span class="o">=</span> <span class="s2">&quot;ignore&quot;</span><span class="p">),</span> <span class="n">categorical_feats</span><span class="p">),</span>
    <span class="p">(</span><span class="n">OneHotEncoder</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">handle_unknown</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">categories</span><span class="o">=</span><span class="p">[</span><span class="n">most_frequent</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="p">]),</span> <span class="n">artist_cat_feat</span><span class="p">),</span>
    <span class="p">(</span><span class="n">CountVectorizer</span><span class="p">(</span><span class="n">max_features</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span> <span class="n">stop_words</span><span class="o">=</span><span class="s2">&quot;english&quot;</span><span class="p">),</span> <span class="n">text_feat</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">models</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;Decision Tree&quot;</span><span class="p">:</span> <span class="n">DecisionTreeClassifier</span><span class="p">(),</span>
    <span class="s2">&quot;KNN&quot;</span><span class="p">:</span> <span class="n">KNeighborsClassifier</span><span class="p">(),</span>
    <span class="s2">&quot;SVM&quot;</span><span class="p">:</span> <span class="n">SVC</span><span class="p">()</span>    
<span class="p">}</span>

<span class="k">for</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span> <span class="ow">in</span> <span class="n">models</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">pipe_model</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">preprocessor_artist</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span>
    <span class="n">results</span><span class="p">[</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot; (all)&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mean_std_cross_val_scores</span><span class="p">(</span><span class="n">pipe_model</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">return_train_score</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>fit_time</th>
      <th>score_time</th>
      <th>test_score</th>
      <th>train_score</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>dummy</th>
      <td>0.000 (+/- 0.000)</td>
      <td>0.000 (+/- 0.000)</td>
      <td>0.508 (+/- 0.001)</td>
      <td>0.508 (+/- 0.000)</td>
    </tr>
    <tr>
      <th>Decision Tree (no_text)</th>
      <td>0.016 (+/- 0.000)</td>
      <td>0.003 (+/- 0.000)</td>
      <td>0.688 (+/- 0.023)</td>
      <td>1.000 (+/- 0.000)</td>
    </tr>
    <tr>
      <th>KNN (no_text)</th>
      <td>0.005 (+/- 0.001)</td>
      <td>0.015 (+/- 0.020)</td>
      <td>0.676 (+/- 0.028)</td>
      <td>0.788 (+/- 0.009)</td>
    </tr>
    <tr>
      <th>SVM (no_text)</th>
      <td>0.054 (+/- 0.004)</td>
      <td>0.021 (+/- 0.001)</td>
      <td>0.737 (+/- 0.017)</td>
      <td>0.806 (+/- 0.011)</td>
    </tr>
    <tr>
      <th>Decision Tree (text)</th>
      <td>0.035 (+/- 0.002)</td>
      <td>0.005 (+/- 0.001)</td>
      <td>0.700 (+/- 0.027)</td>
      <td>1.000 (+/- 0.000)</td>
    </tr>
    <tr>
      <th>KNN (text)</th>
      <td>0.012 (+/- 0.002)</td>
      <td>0.031 (+/- 0.004)</td>
      <td>0.682 (+/- 0.028)</td>
      <td>0.786 (+/- 0.010)</td>
    </tr>
    <tr>
      <th>SVM (text)</th>
      <td>0.059 (+/- 0.003)</td>
      <td>0.014 (+/- 0.001)</td>
      <td>0.733 (+/- 0.027)</td>
      <td>0.866 (+/- 0.004)</td>
    </tr>
    <tr>
      <th>Decision Tree (all)</th>
      <td>0.028 (+/- 0.001)</td>
      <td>0.005 (+/- 0.001)</td>
      <td>0.684 (+/- 0.035)</td>
      <td>1.000 (+/- 0.000)</td>
    </tr>
    <tr>
      <th>KNN (all)</th>
      <td>0.012 (+/- 0.000)</td>
      <td>0.026 (+/- 0.001)</td>
      <td>0.681 (+/- 0.032)</td>
      <td>0.792 (+/- 0.008)</td>
    </tr>
    <tr>
      <th>SVM (all)</th>
      <td>0.052 (+/- 0.004)</td>
      <td>0.013 (+/- 0.000)</td>
      <td>0.741 (+/- 0.027)</td>
      <td>0.833 (+/- 0.006)</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Tiny bit improvement in the mean CV scores but we are still overfitting.</p>
<p><br><br><br><br></p>
</section>
</section>
<section id="optional-incorporating-text-features-in-the-restaurant-survey-dataset">
<h2>(Optional) Incorporating text features in the restaurant survey dataset<a class="headerlink" href="#optional-incorporating-text-features-in-the-restaurant-survey-dataset" title="Permalink to this heading">#</a></h2>
<p>Do you recall <a class="reference external" href="https://ubc.ca1.qualtrics.com/jfe/form/SV_73VuZiuwM1eDVrw">the restaurants survey</a> you completed at the start of the course?</p>
<p>Let’s use that data for this demo. You’ll find a <a class="reference external" href="https://github.ubc.ca/MDS-2023-24/DSCI_571_sup-learn-1_students/blob/master/lectures/data/cleaned_restaurant_data.csv">wrangled version</a> in the course repository.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;../data/cleaned_restaurant_data.csv&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>north_america</th>
      <th>eat_out_freq</th>
      <th>age</th>
      <th>n_people</th>
      <th>price</th>
      <th>food_type</th>
      <th>noise_level</th>
      <th>good_server</th>
      <th>comments</th>
      <th>restaurant_name</th>
      <th>target</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Yes</td>
      <td>3.0</td>
      <td>29</td>
      <td>10.0</td>
      <td>120.0</td>
      <td>Italian</td>
      <td>medium</td>
      <td>Yes</td>
      <td>Ambience</td>
      <td>NaN</td>
      <td>dislike</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Yes</td>
      <td>2.0</td>
      <td>23</td>
      <td>3.0</td>
      <td>20.0</td>
      <td>Canadian/American</td>
      <td>no music</td>
      <td>No</td>
      <td>food tastes bad</td>
      <td>NaN</td>
      <td>dislike</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Yes</td>
      <td>2.0</td>
      <td>21</td>
      <td>20.0</td>
      <td>15.0</td>
      <td>Chinese</td>
      <td>medium</td>
      <td>Yes</td>
      <td>bad food</td>
      <td>NaN</td>
      <td>dislike</td>
    </tr>
    <tr>
      <th>3</th>
      <td>No</td>
      <td>2.0</td>
      <td>24</td>
      <td>14.0</td>
      <td>18.0</td>
      <td>Other</td>
      <td>medium</td>
      <td>No</td>
      <td>Overall vibe on the restaurant</td>
      <td>NaN</td>
      <td>dislike</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Yes</td>
      <td>5.0</td>
      <td>23</td>
      <td>30.0</td>
      <td>20.0</td>
      <td>Chinese</td>
      <td>medium</td>
      <td>Yes</td>
      <td>A bad day</td>
      <td>NaN</td>
      <td>dislike</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>959</th>
      <td>No</td>
      <td>10.0</td>
      <td>22</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>like</td>
    </tr>
    <tr>
      <th>960</th>
      <td>Yes</td>
      <td>1.0</td>
      <td>20</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>like</td>
    </tr>
    <tr>
      <th>961</th>
      <td>No</td>
      <td>1.0</td>
      <td>22</td>
      <td>40.0</td>
      <td>50.0</td>
      <td>Chinese</td>
      <td>medium</td>
      <td>Yes</td>
      <td>The self service sauce table is very clean and the sauces were always filled up.</td>
      <td>Haidilao</td>
      <td>like</td>
    </tr>
    <tr>
      <th>962</th>
      <td>Yes</td>
      <td>3.0</td>
      <td>21</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>like</td>
    </tr>
    <tr>
      <th>963</th>
      <td>Yes</td>
      <td>3.0</td>
      <td>27</td>
      <td>20.0</td>
      <td>22.0</td>
      <td>Other</td>
      <td>medium</td>
      <td>Yes</td>
      <td>Lots of meat that was very soft and tasty. Hearty and amazing broth. Good noodle thickness and consistency</td>
      <td>Uno Beef Noodle</td>
      <td>like</td>
    </tr>
  </tbody>
</table>
<p>964 rows × 11 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>eat_out_freq</th>
      <th>age</th>
      <th>n_people</th>
      <th>price</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>964.000000</td>
      <td>964.000000</td>
      <td>6.960000e+02</td>
      <td>696.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>2.585187</td>
      <td>23.975104</td>
      <td>1.439254e+04</td>
      <td>1472.179152</td>
    </tr>
    <tr>
      <th>std</th>
      <td>2.246486</td>
      <td>4.556716</td>
      <td>3.790481e+05</td>
      <td>37903.575636</td>
    </tr>
    <tr>
      <th>min</th>
      <td>0.000000</td>
      <td>10.000000</td>
      <td>-2.000000e+00</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>1.000000</td>
      <td>21.000000</td>
      <td>1.000000e+01</td>
      <td>18.000000</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>2.000000</td>
      <td>22.000000</td>
      <td>2.000000e+01</td>
      <td>25.000000</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>3.000000</td>
      <td>26.000000</td>
      <td>3.000000e+01</td>
      <td>40.000000</td>
    </tr>
    <tr>
      <th>max</th>
      <td>15.000000</td>
      <td>46.000000</td>
      <td>1.000000e+07</td>
      <td>1000000.000000</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Are there any unusual values in this data that you notice?
Let’s get rid of these outliers.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">upperbound_price</span> <span class="o">=</span> <span class="mi">200</span>
<span class="n">lowerbound_people</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="o">~</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;price&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">200</span><span class="p">)]</span>
<span class="n">restaurant_df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="o">~</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;n_people&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">lowerbound_people</span><span class="p">)]</span>
<span class="n">restaurant_df</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(942, 11)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">restaurant_df</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>eat_out_freq</th>
      <th>age</th>
      <th>n_people</th>
      <th>price</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>942.000000</td>
      <td>942.000000</td>
      <td>674.000000</td>
      <td>674.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>2.598057</td>
      <td>23.992569</td>
      <td>24.973294</td>
      <td>34.023279</td>
    </tr>
    <tr>
      <th>std</th>
      <td>2.257787</td>
      <td>4.582570</td>
      <td>22.016660</td>
      <td>29.018622</td>
    </tr>
    <tr>
      <th>min</th>
      <td>0.000000</td>
      <td>10.000000</td>
      <td>1.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>1.000000</td>
      <td>21.000000</td>
      <td>10.000000</td>
      <td>18.000000</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>2.000000</td>
      <td>22.000000</td>
      <td>20.000000</td>
      <td>25.000000</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>3.000000</td>
      <td>26.000000</td>
      <td>30.000000</td>
      <td>40.000000</td>
    </tr>
    <tr>
      <th>max</th>
      <td>15.000000</td>
      <td>46.000000</td>
      <td>200.000000</td>
      <td>200.000000</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<section id="data-splitting">
<h3>Data splitting<a class="headerlink" href="#data-splitting" title="Permalink to this heading">#</a></h3>
<p>We aim to predict whether a restaurant is liked or disliked.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Separate `X` and `y`. </span>

<span class="n">X</span> <span class="o">=</span> <span class="n">restaurant_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;target&#39;</span><span class="p">])</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">restaurant_df</span><span class="p">[</span><span class="s1">&#39;target&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>Below I’m perturbing this data just to demonstrate a few concepts. Don’t do it in real life.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="mi">459</span><span class="p">,</span> <span class="s1">&#39;food_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Quebecois&#39;</span>
<span class="n">X</span><span class="p">[</span><span class="s1">&#39;price&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="s1">&#39;price&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">100</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Split the data</span>

<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">123</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><br><br></p>
</section>
<section id="eda">
<h3>EDA<a class="headerlink" href="#eda" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_train</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">8</span><span class="p">));</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/68ff031efb478ebec94631ba3dec1559ee7e02865d5763fb673d1021760378b6.png" src="../../_images/68ff031efb478ebec94631ba3dec1559ee7e02865d5763fb673d1021760378b6.png" />
</div>
</div>
<p>Do you see anything interesting in these plots?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_train</span><span class="p">[</span><span class="s1">&#39;food_type&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>food_type
Other                189
Canadian/American    131
Chinese              102
Indian                36
Italian               32
Thai                  20
Fusion                18
Mexican               17
fusion                 3
Quebecois              1
Name: count, dtype: int64
</pre></div>
</div>
</div>
</div>
<p>Error in data collection? Probably “Fusion” and “fusion” categories should be combined?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_train</span><span class="p">[</span><span class="s1">&#39;food_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">X_train</span><span class="p">[</span><span class="s1">&#39;food_type&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;fusion&quot;</span><span class="p">,</span> <span class="s2">&quot;Fusion&quot;</span><span class="p">)</span>
<span class="n">X_test</span><span class="p">[</span><span class="s1">&#39;food_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">X_test</span><span class="p">[</span><span class="s1">&#39;food_type&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;fusion&quot;</span><span class="p">,</span> <span class="s2">&quot;Fusion&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_train</span><span class="p">[</span><span class="s1">&#39;food_type&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>food_type
Other                189
Canadian/American    131
Chinese              102
Indian                36
Italian               32
Fusion                21
Thai                  20
Mexican               17
Quebecois              1
Name: count, dtype: int64
</pre></div>
</div>
</div>
</div>
<p>Again, usually we should spend lots of time in EDA, but let’s stop here so that we have time to learn about transformers and pipelines.</p>
<p><br><br></p>
</section>
<section id="dummy-classifier">
<h3>Dummy Classifier<a class="headerlink" href="#dummy-classifier" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.dummy</span> <span class="kn">import</span> <span class="n">DummyClassifier</span>

<span class="n">results_df</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">dummy</span> <span class="o">=</span> <span class="n">DummyClassifier</span><span class="p">()</span>
<span class="n">results_df</span><span class="p">[</span><span class="s1">&#39;dummy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mean_std_cross_val_scores</span><span class="p">(</span><span class="n">dummy</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">return_train_score</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results_df</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>dummy</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>fit_time</th>
      <td>0.001 (+/- 0.000)</td>
    </tr>
    <tr>
      <th>score_time</th>
      <td>0.001 (+/- 0.000)</td>
    </tr>
    <tr>
      <th>test_score</th>
      <td>0.515 (+/- 0.002)</td>
    </tr>
    <tr>
      <th>train_score</th>
      <td>0.515 (+/- 0.000)</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>We have a relatively balanced distribution of both ‘like’ and ‘dislike’ classes.</p>
<p><br><br></p>
</section>
<section id="preprocessing">
<h3>Preprocessing<a class="headerlink" href="#preprocessing" title="Permalink to this heading">#</a></h3>
<p>How can we horizontally stack</p>
<ul class="simple">
<li><p>preprocessed numeric features,</p></li>
<li><p>preprocessed binary features,</p></li>
<li><p>preprocessed ordinal features, and</p></li>
<li><p>preprocessed categorical features?</p></li>
</ul>
<p>Let’s define a column transformer.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">numeric_feats</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;age&#39;</span><span class="p">,</span> <span class="s1">&#39;n_people&#39;</span><span class="p">,</span> <span class="s1">&#39;price&#39;</span><span class="p">]</span> <span class="c1"># Continuous and quantitative features</span>
<span class="n">categorical_feats</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;north_america&#39;</span><span class="p">,</span> <span class="s1">&#39;food_type&#39;</span><span class="p">]</span> <span class="c1"># Discrete and qualitative features</span>
<span class="n">binary_feats</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;good_server&#39;</span><span class="p">]</span> <span class="c1"># Categorical features with only two possible values </span>
<span class="n">ordinal_feats</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;noise_level&#39;</span><span class="p">]</span> <span class="c1"># Some natural ordering in the categories </span>
<span class="n">noise_cats</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;no music&#39;</span><span class="p">,</span> <span class="s1">&#39;low&#39;</span><span class="p">,</span> <span class="s1">&#39;medium&#39;</span><span class="p">,</span> <span class="s1">&#39;high&#39;</span><span class="p">,</span> <span class="s1">&#39;crazy loud&#39;</span><span class="p">]</span>
<span class="n">drop_feats</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;comments&#39;</span><span class="p">,</span> <span class="s1">&#39;restaurant_name&#39;</span><span class="p">,</span> <span class="s1">&#39;eat_out_freq&#39;</span><span class="p">]</span> <span class="c1"># Dropping text feats and `eat_out_freq` because it&#39;s not that useful</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_train</span><span class="p">[</span><span class="s1">&#39;noise_level&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>noise_level
medium        232
low           186
high           75
no music       37
crazy loud     18
Name: count, dtype: int64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">noise_levels</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;no music&quot;</span><span class="p">,</span> <span class="s2">&quot;low&quot;</span><span class="p">,</span> <span class="s2">&quot;medium&quot;</span><span class="p">,</span> <span class="s2">&quot;high&quot;</span><span class="p">,</span> <span class="s2">&quot;crazy loud&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.impute</span> <span class="kn">import</span> <span class="n">SimpleImputer</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">OneHotEncoder</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">OrdinalEncoder</span>

<span class="kn">from</span> <span class="nn">sklearn.compose</span> <span class="kn">import</span> <span class="n">make_column_transformer</span>

<span class="n">numeric_transformer</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">SimpleImputer</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="s2">&quot;median&quot;</span><span class="p">),</span>
                                    <span class="n">StandardScaler</span><span class="p">())</span> 
<span class="n">binary_transformer</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">SimpleImputer</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="s2">&quot;most_frequent&quot;</span><span class="p">),</span> 
                                    <span class="n">OneHotEncoder</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="s2">&quot;if_binary&quot;</span><span class="p">))</span>
<span class="n">ordinal_transformer</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">SimpleImputer</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="s2">&quot;most_frequent&quot;</span><span class="p">),</span> 
                                    <span class="n">OrdinalEncoder</span><span class="p">(</span><span class="n">categories</span><span class="o">=</span><span class="p">[</span><span class="n">noise_levels</span><span class="p">]))</span>
<span class="n">categorical_transformer</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">SimpleImputer</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="s2">&quot;most_frequent&quot;</span><span class="p">),</span> 
                                    <span class="n">OneHotEncoder</span><span class="p">(</span><span class="n">sparse_output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">handle_unknown</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">))</span>

<span class="n">preprocessor</span> <span class="o">=</span> <span class="n">make_column_transformer</span><span class="p">(</span>
    <span class="p">(</span><span class="n">numeric_transformer</span><span class="p">,</span> <span class="n">numeric_feats</span><span class="p">),</span> 
    <span class="p">(</span><span class="n">binary_transformer</span><span class="p">,</span> <span class="n">binary_feats</span><span class="p">),</span> 
    <span class="p">(</span><span class="n">ordinal_transformer</span><span class="p">,</span> <span class="n">ordinal_feats</span><span class="p">),</span>
    <span class="p">(</span><span class="n">categorical_transformer</span><span class="p">,</span> <span class="n">categorical_feats</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;drop&quot;</span><span class="p">,</span> <span class="n">drop_feats</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>How does the transformed data look like?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">transformed</span> <span class="o">=</span> <span class="n">preprocessor</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
<span class="n">transformed</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(753, 17)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">preprocessor</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style>#sk-container-id-3 {color: black;}#sk-container-id-3 pre{padding: 0;}#sk-container-id-3 div.sk-toggleable {background-color: white;}#sk-container-id-3 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-container-id-3 label.sk-toggleable__label-arrow:before {content: "▸";float: left;margin-right: 0.25em;color: #696969;}#sk-container-id-3 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-container-id-3 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-container-id-3 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-container-id-3 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-container-id-3 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-container-id-3 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "▾";}#sk-container-id-3 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-3 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-3 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-container-id-3 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-container-id-3 div.sk-estimator:hover {background-color: #d4ebff;}#sk-container-id-3 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-container-id-3 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-3 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: 0;}#sk-container-id-3 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;position: relative;}#sk-container-id-3 div.sk-item {position: relative;z-index: 1;}#sk-container-id-3 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;position: relative;}#sk-container-id-3 div.sk-item::before, #sk-container-id-3 div.sk-parallel-item::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: -1;}#sk-container-id-3 div.sk-parallel-item {display: flex;flex-direction: column;z-index: 1;position: relative;background-color: white;}#sk-container-id-3 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-container-id-3 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-container-id-3 div.sk-parallel-item:only-child::after {width: 0;}#sk-container-id-3 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;}#sk-container-id-3 div.sk-label label {font-family: monospace;font-weight: bold;display: inline-block;line-height: 1.2em;}#sk-container-id-3 div.sk-label-container {text-align: center;}#sk-container-id-3 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-container-id-3 div.sk-text-repr-fallback {display: none;}</style><div id="sk-container-id-3" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>ColumnTransformer(transformers=[(&#x27;pipeline-1&#x27;,
                                 Pipeline(steps=[(&#x27;simpleimputer&#x27;,
                                                  SimpleImputer(strategy=&#x27;median&#x27;)),
                                                 (&#x27;standardscaler&#x27;,
                                                  StandardScaler())]),
                                 [&#x27;age&#x27;, &#x27;n_people&#x27;, &#x27;price&#x27;]),
                                (&#x27;pipeline-2&#x27;,
                                 Pipeline(steps=[(&#x27;simpleimputer&#x27;,
                                                  SimpleImputer(strategy=&#x27;most_frequent&#x27;)),
                                                 (&#x27;onehotencoder&#x27;,
                                                  OneHotEncoder(drop=&#x27;if_binary&#x27;))]),
                                 [&#x27;good_server&#x27;]),
                                (&#x27;pipeline-3&#x27;,...
                                                  OrdinalEncoder(categories=[[&#x27;no &#x27;
                                                                              &#x27;music&#x27;,
                                                                              &#x27;low&#x27;,
                                                                              &#x27;medium&#x27;,
                                                                              &#x27;high&#x27;,
                                                                              &#x27;crazy &#x27;
                                                                              &#x27;loud&#x27;]]))]),
                                 [&#x27;noise_level&#x27;]),
                                (&#x27;pipeline-4&#x27;,
                                 Pipeline(steps=[(&#x27;simpleimputer&#x27;,
                                                  SimpleImputer(strategy=&#x27;most_frequent&#x27;)),
                                                 (&#x27;onehotencoder&#x27;,
                                                  OneHotEncoder(handle_unknown=&#x27;ignore&#x27;,
                                                                sparse_output=False))]),
                                 [&#x27;north_america&#x27;, &#x27;food_type&#x27;]),
                                (&#x27;drop&#x27;, &#x27;drop&#x27;,
                                 [&#x27;comments&#x27;, &#x27;restaurant_name&#x27;,
                                  &#x27;eat_out_freq&#x27;])])</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-17" type="checkbox" ><label for="sk-estimator-id-17" class="sk-toggleable__label sk-toggleable__label-arrow">ColumnTransformer</label><div class="sk-toggleable__content"><pre>ColumnTransformer(transformers=[(&#x27;pipeline-1&#x27;,
                                 Pipeline(steps=[(&#x27;simpleimputer&#x27;,
                                                  SimpleImputer(strategy=&#x27;median&#x27;)),
                                                 (&#x27;standardscaler&#x27;,
                                                  StandardScaler())]),
                                 [&#x27;age&#x27;, &#x27;n_people&#x27;, &#x27;price&#x27;]),
                                (&#x27;pipeline-2&#x27;,
                                 Pipeline(steps=[(&#x27;simpleimputer&#x27;,
                                                  SimpleImputer(strategy=&#x27;most_frequent&#x27;)),
                                                 (&#x27;onehotencoder&#x27;,
                                                  OneHotEncoder(drop=&#x27;if_binary&#x27;))]),
                                 [&#x27;good_server&#x27;]),
                                (&#x27;pipeline-3&#x27;,...
                                                  OrdinalEncoder(categories=[[&#x27;no &#x27;
                                                                              &#x27;music&#x27;,
                                                                              &#x27;low&#x27;,
                                                                              &#x27;medium&#x27;,
                                                                              &#x27;high&#x27;,
                                                                              &#x27;crazy &#x27;
                                                                              &#x27;loud&#x27;]]))]),
                                 [&#x27;noise_level&#x27;]),
                                (&#x27;pipeline-4&#x27;,
                                 Pipeline(steps=[(&#x27;simpleimputer&#x27;,
                                                  SimpleImputer(strategy=&#x27;most_frequent&#x27;)),
                                                 (&#x27;onehotencoder&#x27;,
                                                  OneHotEncoder(handle_unknown=&#x27;ignore&#x27;,
                                                                sparse_output=False))]),
                                 [&#x27;north_america&#x27;, &#x27;food_type&#x27;]),
                                (&#x27;drop&#x27;, &#x27;drop&#x27;,
                                 [&#x27;comments&#x27;, &#x27;restaurant_name&#x27;,
                                  &#x27;eat_out_freq&#x27;])])</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-18" type="checkbox" ><label for="sk-estimator-id-18" class="sk-toggleable__label sk-toggleable__label-arrow">pipeline-1</label><div class="sk-toggleable__content"><pre>[&#x27;age&#x27;, &#x27;n_people&#x27;, &#x27;price&#x27;]</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-19" type="checkbox" ><label for="sk-estimator-id-19" class="sk-toggleable__label sk-toggleable__label-arrow">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer(strategy=&#x27;median&#x27;)</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-20" type="checkbox" ><label for="sk-estimator-id-20" class="sk-toggleable__label sk-toggleable__label-arrow">StandardScaler</label><div class="sk-toggleable__content"><pre>StandardScaler()</pre></div></div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-21" type="checkbox" ><label for="sk-estimator-id-21" class="sk-toggleable__label sk-toggleable__label-arrow">pipeline-2</label><div class="sk-toggleable__content"><pre>[&#x27;good_server&#x27;]</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-22" type="checkbox" ><label for="sk-estimator-id-22" class="sk-toggleable__label sk-toggleable__label-arrow">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer(strategy=&#x27;most_frequent&#x27;)</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-23" type="checkbox" ><label for="sk-estimator-id-23" class="sk-toggleable__label sk-toggleable__label-arrow">OneHotEncoder</label><div class="sk-toggleable__content"><pre>OneHotEncoder(drop=&#x27;if_binary&#x27;)</pre></div></div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-24" type="checkbox" ><label for="sk-estimator-id-24" class="sk-toggleable__label sk-toggleable__label-arrow">pipeline-3</label><div class="sk-toggleable__content"><pre>[&#x27;noise_level&#x27;]</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-25" type="checkbox" ><label for="sk-estimator-id-25" class="sk-toggleable__label sk-toggleable__label-arrow">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer(strategy=&#x27;most_frequent&#x27;)</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-26" type="checkbox" ><label for="sk-estimator-id-26" class="sk-toggleable__label sk-toggleable__label-arrow">OrdinalEncoder</label><div class="sk-toggleable__content"><pre>OrdinalEncoder(categories=[[&#x27;no music&#x27;, &#x27;low&#x27;, &#x27;medium&#x27;, &#x27;high&#x27;, &#x27;crazy loud&#x27;]])</pre></div></div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-27" type="checkbox" ><label for="sk-estimator-id-27" class="sk-toggleable__label sk-toggleable__label-arrow">pipeline-4</label><div class="sk-toggleable__content"><pre>[&#x27;north_america&#x27;, &#x27;food_type&#x27;]</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-28" type="checkbox" ><label for="sk-estimator-id-28" class="sk-toggleable__label sk-toggleable__label-arrow">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer(strategy=&#x27;most_frequent&#x27;)</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-29" type="checkbox" ><label for="sk-estimator-id-29" class="sk-toggleable__label sk-toggleable__label-arrow">OneHotEncoder</label><div class="sk-toggleable__content"><pre>OneHotEncoder(handle_unknown=&#x27;ignore&#x27;, sparse_output=False)</pre></div></div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-30" type="checkbox" ><label for="sk-estimator-id-30" class="sk-toggleable__label sk-toggleable__label-arrow">drop</label><div class="sk-toggleable__content"><pre>[&#x27;comments&#x27;, &#x27;restaurant_name&#x27;, &#x27;eat_out_freq&#x27;]</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-31" type="checkbox" ><label for="sk-estimator-id-31" class="sk-toggleable__label sk-toggleable__label-arrow">drop</label><div class="sk-toggleable__content"><pre>drop</pre></div></div></div></div></div></div></div></div></div></div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Getting feature names from a column transformer</span>
<span class="n">ohe_feat_names</span> <span class="o">=</span> <span class="n">preprocessor</span><span class="o">.</span><span class="n">named_transformers_</span><span class="p">[</span><span class="s1">&#39;pipeline-4&#39;</span><span class="p">][</span><span class="s1">&#39;onehotencoder&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_feature_names_out</span><span class="p">(</span><span class="n">categorical_feats</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="n">ohe_feat_names</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&quot;north_america_Don&#39;t want to share&quot;,
 &#39;north_america_No&#39;,
 &#39;north_america_Yes&#39;,
 &#39;food_type_Canadian/American&#39;,
 &#39;food_type_Chinese&#39;,
 &#39;food_type_Fusion&#39;,
 &#39;food_type_Indian&#39;,
 &#39;food_type_Italian&#39;,
 &#39;food_type_Mexican&#39;,
 &#39;food_type_Other&#39;,
 &#39;food_type_Quebecois&#39;,
 &#39;food_type_Thai&#39;]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">numeric_feats</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;age&#39;, &#39;n_people&#39;, &#39;price&#39;]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">feat_names</span> <span class="o">=</span> <span class="n">numeric_feats</span> <span class="o">+</span> <span class="n">binary_feats</span> <span class="o">+</span> <span class="n">ordinal_feats</span> <span class="o">+</span> <span class="n">ohe_feat_names</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">transformed</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[-0.66941678,  0.31029469, -0.36840629, ...,  0.        ,
         0.        ,  0.        ],
       [-0.66941678,  0.31029469, -0.05422496, ...,  0.        ,
         0.        ,  0.        ],
       [-0.89515383,  0.82336432, -0.25058829, ...,  0.        ,
         0.        ,  0.        ],
       ...,
       [-0.89515383, -0.97237936, -0.64331495, ...,  0.        ,
         0.        ,  0.        ],
       [-0.89515383, -0.20277493, -0.25058829, ...,  1.        ,
         0.        ,  0.        ],
       [-0.89515383,  1.33643394, -0.05422496, ...,  0.        ,
         0.        ,  0.        ]])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">transformed</span><span class="p">,</span> <span class="n">columns</span> <span class="o">=</span> <span class="n">feat_names</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>age</th>
      <th>n_people</th>
      <th>price</th>
      <th>good_server</th>
      <th>noise_level</th>
      <th>north_america_Don't want to share</th>
      <th>north_america_No</th>
      <th>north_america_Yes</th>
      <th>food_type_Canadian/American</th>
      <th>food_type_Chinese</th>
      <th>food_type_Fusion</th>
      <th>food_type_Indian</th>
      <th>food_type_Italian</th>
      <th>food_type_Mexican</th>
      <th>food_type_Other</th>
      <th>food_type_Quebecois</th>
      <th>food_type_Thai</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>-0.669417</td>
      <td>0.310295</td>
      <td>-0.368406</td>
      <td>0.0</td>
      <td>3.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>-0.669417</td>
      <td>0.310295</td>
      <td>-0.054225</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>-0.895154</td>
      <td>0.823364</td>
      <td>-0.250588</td>
      <td>1.0</td>
      <td>2.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>-0.669417</td>
      <td>-0.202775</td>
      <td>-0.250588</td>
      <td>1.0</td>
      <td>2.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.007794</td>
      <td>-0.202775</td>
      <td>-0.054225</td>
      <td>1.0</td>
      <td>3.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>748</th>
      <td>0.685006</td>
      <td>-0.715845</td>
      <td>-0.643315</td>
      <td>1.0</td>
      <td>2.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>749</th>
      <td>0.007794</td>
      <td>-0.613231</td>
      <td>-0.918224</td>
      <td>1.0</td>
      <td>2.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>750</th>
      <td>-0.895154</td>
      <td>-0.972379</td>
      <td>-0.643315</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>751</th>
      <td>-0.895154</td>
      <td>-0.202775</td>
      <td>-0.250588</td>
      <td>1.0</td>
      <td>2.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>752</th>
      <td>-0.895154</td>
      <td>1.336434</td>
      <td>-0.054225</td>
      <td>1.0</td>
      <td>3.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
<p>753 rows × 17 columns</p>
</div></div></div>
</div>
<p>We have new columns for the categorical features. Let’s create a pipeline with the preprocessor and SVC.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.tree</span> <span class="kn">import</span> <span class="n">DecisionTreeClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.neighbors</span> <span class="kn">import</span> <span class="n">KNeighborsClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.svm</span> <span class="kn">import</span> <span class="n">SVC</span>
<span class="n">models</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;Decision Tree&quot;</span><span class="p">:</span> <span class="n">DecisionTreeClassifier</span><span class="p">(),</span>
    <span class="s2">&quot;KNN&quot;</span><span class="p">:</span> <span class="n">KNeighborsClassifier</span><span class="p">(),</span>
    <span class="s2">&quot;SVM&quot;</span><span class="p">:</span> <span class="n">SVC</span><span class="p">()</span>    
<span class="p">}</span>

<span class="k">for</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span> <span class="ow">in</span> <span class="n">models</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">pipe_num_model</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">SimpleImputer</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="s2">&quot;median&quot;</span><span class="p">),</span> <span class="n">StandardScaler</span><span class="p">(),</span> <span class="n">model</span><span class="p">)</span>
    <span class="n">results_df</span><span class="p">[</span><span class="n">name</span> <span class="o">+</span><span class="s1">&#39; (numeric-only)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mean_std_cross_val_scores</span><span class="p">(</span><span class="n">pipe_num_model</span><span class="p">,</span> <span class="n">X_train</span><span class="p">[</span><span class="n">numeric_feats</span><span class="p">],</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">return_train_score</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results_df</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>fit_time</th>
      <th>score_time</th>
      <th>test_score</th>
      <th>train_score</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>dummy</th>
      <td>0.001 (+/- 0.000)</td>
      <td>0.001 (+/- 0.000)</td>
      <td>0.515 (+/- 0.002)</td>
      <td>0.515 (+/- 0.000)</td>
    </tr>
    <tr>
      <th>Decision Tree (numeric-only)</th>
      <td>0.003 (+/- 0.000)</td>
      <td>0.001 (+/- 0.000)</td>
      <td>0.497 (+/- 0.038)</td>
      <td>0.833 (+/- 0.010)</td>
    </tr>
    <tr>
      <th>KNN (numeric-only)</th>
      <td>0.003 (+/- 0.001)</td>
      <td>0.004 (+/- 0.000)</td>
      <td>0.525 (+/- 0.034)</td>
      <td>0.674 (+/- 0.015)</td>
    </tr>
    <tr>
      <th>SVM (numeric-only)</th>
      <td>0.012 (+/- 0.000)</td>
      <td>0.005 (+/- 0.000)</td>
      <td>0.587 (+/- 0.033)</td>
      <td>0.623 (+/- 0.006)</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span> <span class="ow">in</span> <span class="n">models</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">pipe_model</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">preprocessor</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span>
    <span class="n">results_df</span><span class="p">[</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;(non-text feats)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mean_std_cross_val_scores</span><span class="p">(</span><span class="n">pipe_model</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">return_train_score</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results_df</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>fit_time</th>
      <th>score_time</th>
      <th>test_score</th>
      <th>train_score</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>dummy</th>
      <td>0.001 (+/- 0.000)</td>
      <td>0.001 (+/- 0.000)</td>
      <td>0.515 (+/- 0.002)</td>
      <td>0.515 (+/- 0.000)</td>
    </tr>
    <tr>
      <th>Decision Tree (numeric-only)</th>
      <td>0.003 (+/- 0.000)</td>
      <td>0.001 (+/- 0.000)</td>
      <td>0.497 (+/- 0.038)</td>
      <td>0.833 (+/- 0.010)</td>
    </tr>
    <tr>
      <th>KNN (numeric-only)</th>
      <td>0.003 (+/- 0.001)</td>
      <td>0.004 (+/- 0.000)</td>
      <td>0.525 (+/- 0.034)</td>
      <td>0.674 (+/- 0.015)</td>
    </tr>
    <tr>
      <th>SVM (numeric-only)</th>
      <td>0.012 (+/- 0.000)</td>
      <td>0.005 (+/- 0.000)</td>
      <td>0.587 (+/- 0.033)</td>
      <td>0.623 (+/- 0.006)</td>
    </tr>
    <tr>
      <th>Decision Tree(non-text feats)</th>
      <td>0.009 (+/- 0.000)</td>
      <td>0.003 (+/- 0.000)</td>
      <td>0.590 (+/- 0.039)</td>
      <td>0.889 (+/- 0.008)</td>
    </tr>
    <tr>
      <th>KNN(non-text feats)</th>
      <td>0.008 (+/- 0.000)</td>
      <td>0.004 (+/- 0.000)</td>
      <td>0.598 (+/- 0.023)</td>
      <td>0.737 (+/- 0.008)</td>
    </tr>
    <tr>
      <th>SVM(non-text feats)</th>
      <td>0.019 (+/- 0.000)</td>
      <td>0.008 (+/- 0.000)</td>
      <td>0.687 (+/- 0.011)</td>
      <td>0.733 (+/- 0.008)</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>We are getting better results when we include numeric, categorical, binary, ordinal features.
<br><br><br></p>
</section>
<section id="incorporating-text-features">
<h3>Incorporating text features<a class="headerlink" href="#incorporating-text-features" title="Permalink to this heading">#</a></h3>
<p>We haven’t incorporated the comments feature into our pipeline yet, even though it holds significant value in indicating whether the restaurant was liked or not.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_train</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>north_america</th>
      <th>eat_out_freq</th>
      <th>age</th>
      <th>n_people</th>
      <th>price</th>
      <th>food_type</th>
      <th>noise_level</th>
      <th>good_server</th>
      <th>comments</th>
      <th>restaurant_name</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>80</th>
      <td>No</td>
      <td>2.0</td>
      <td>21</td>
      <td>30.0</td>
      <td>2200.0</td>
      <td>Chinese</td>
      <td>high</td>
      <td>No</td>
      <td>The environment was very not clean. The food tasted awful.</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>934</th>
      <td>Yes</td>
      <td>4.0</td>
      <td>21</td>
      <td>30.0</td>
      <td>3000.0</td>
      <td>Canadian/American</td>
      <td>low</td>
      <td>Yes</td>
      <td>The building and the room gave a very comfy feeling. Immediately after sitting down it felt like we were right at home.</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>911</th>
      <td>No</td>
      <td>4.0</td>
      <td>20</td>
      <td>40.0</td>
      <td>2500.0</td>
      <td>Canadian/American</td>
      <td>medium</td>
      <td>Yes</td>
      <td>I was hungry</td>
      <td>Chambar</td>
    </tr>
    <tr>
      <th>459</th>
      <td>Yes</td>
      <td>5.0</td>
      <td>21</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>Quebecois</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>62</th>
      <td>Yes</td>
      <td>2.0</td>
      <td>24</td>
      <td>20.0</td>
      <td>3000.0</td>
      <td>Indian</td>
      <td>high</td>
      <td>Yes</td>
      <td>bad taste</td>
      <td>east is east</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>106</th>
      <td>No</td>
      <td>3.0</td>
      <td>27</td>
      <td>10.0</td>
      <td>1500.0</td>
      <td>Chinese</td>
      <td>medium</td>
      <td>Yes</td>
      <td>Food wasn't great.</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>333</th>
      <td>No</td>
      <td>1.0</td>
      <td>24</td>
      <td>12.0</td>
      <td>800.0</td>
      <td>Other</td>
      <td>medium</td>
      <td>Yes</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>393</th>
      <td>Yes</td>
      <td>4.0</td>
      <td>20</td>
      <td>5.0</td>
      <td>1500.0</td>
      <td>Canadian/American</td>
      <td>low</td>
      <td>No</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>376</th>
      <td>Yes</td>
      <td>5.0</td>
      <td>20</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>525</th>
      <td>Don't want to share</td>
      <td>4.0</td>
      <td>20</td>
      <td>50.0</td>
      <td>3000.0</td>
      <td>Chinese</td>
      <td>high</td>
      <td>Yes</td>
      <td>NaN</td>
      <td>Haidilao</td>
    </tr>
  </tbody>
</table>
<p>753 rows × 10 columns</p>
</div></div></div>
</div>
<p>Let’s create bag-of-words representation of the <code class="docutils literal notranslate"><span class="pre">comments</span></code> feature. But first we need to impute the rows where there are no comments. There is a small complication if we want to put <code class="docutils literal notranslate"><span class="pre">SimpleImputer</span></code> and <code class="docutils literal notranslate"><span class="pre">CountVectorizer</span></code> in a pipeline.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">SimpleImputer</span></code> takes a 2D array as input and produced 2D array as output.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CountVectorizer</span></code> takes a 1D array as input.</p></li>
</ul>
<p>To deal with this, we will use sklearn’s <code class="docutils literal notranslate"><span class="pre">FunctionTransformer</span></code> to convert the 2D output of <code class="docutils literal notranslate"><span class="pre">SimpleImputer</span></code> into a 1D array which can be passed to <code class="docutils literal notranslate"><span class="pre">CountVectorizer</span></code> as input.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">FunctionTransformer</span>
<span class="kn">from</span> <span class="nn">sklearn.feature_extraction.text</span> <span class="kn">import</span> <span class="n">CountVectorizer</span>

<span class="n">reshape_for_countvectorizer</span> <span class="o">=</span> <span class="n">FunctionTransformer</span><span class="p">(</span><span class="k">lambda</span> <span class="n">X</span><span class="p">:</span> <span class="n">X</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(),</span> <span class="n">validate</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">text_transformer</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">SimpleImputer</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="s2">&quot;constant&quot;</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="s2">&quot;missing&quot;</span><span class="p">),</span> 
                          <span class="n">reshape_for_countvectorizer</span><span class="p">,</span> 
                          <span class="n">CountVectorizer</span><span class="p">(</span><span class="n">stop_words</span><span class="o">=</span><span class="s2">&quot;english&quot;</span><span class="p">))</span>
<span class="n">text_pipe</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">text_transformer</span><span class="p">,</span> <span class="n">SVC</span><span class="p">())</span>
<span class="n">cross_val_score</span><span class="p">(</span><span class="n">text_pipe</span><span class="p">,</span> <span class="n">X_train</span><span class="p">[[</span><span class="s1">&#39;comments&#39;</span><span class="p">]],</span> <span class="n">y_train</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.6493951434878588
</pre></div>
</div>
</div>
</div>
<p>Pretty good scores just with text features! Let’s examine the transformed data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">transformed</span> <span class="o">=</span> <span class="n">text_transformer</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_train</span><span class="p">[[</span><span class="s1">&#39;comments&#39;</span><span class="p">]],</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">transformed</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;753x548 sparse matrix of type &#39;&lt;class &#39;numpy.int64&#39;&gt;&#39;
	with 1841 stored elements in Compressed Sparse Row format&gt;
</pre></div>
</div>
</div>
</div>
<p>It’s a sparse matrix. Let’s explore the the vocabulary.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">vocab</span> <span class="o">=</span> <span class="n">text_transformer</span><span class="o">.</span><span class="n">named_steps</span><span class="p">[</span><span class="s2">&quot;countvectorizer&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get_feature_names_out</span><span class="p">()</span>
<span class="n">vocab</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([&#39;18&#39;, &#39;30&#39;, &#39;40mins&#39;, &#39;65&#39;, &#39;actually&#39;, &#39;addition&#39;, &#39;affordable&#39;,
       &#39;alcohol&#39;, &#39;ale&#39;, &#39;allergic&#39;], dtype=object)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">vocab</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">10</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([&#39;18&#39;, &#39;30&#39;, &#39;40mins&#39;, &#39;65&#39;, &#39;actually&#39;, &#39;addition&#39;, &#39;affordable&#39;,
       &#39;alcohol&#39;, &#39;ale&#39;, &#39;allergic&#39;], dtype=object)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">vocab</span><span class="p">[</span><span class="mi">200</span><span class="p">:</span><span class="mi">210</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([&#39;fusion&#39;, &#39;games&#39;, &#39;gave&#39;, &#39;general&#39;, &#39;genuinely&#39;, &#39;getting&#39;,
       &#39;ginger&#39;, &#39;girlfriends&#39;, &#39;gluten&#39;, &#39;going&#39;], dtype=object)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">vocab</span><span class="p">[</span><span class="mi">500</span><span class="p">:</span><span class="mi">600</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([&#39;undressed&#39;, &#39;unfresh&#39;, &#39;uni&#39;, &#39;unique&#39;, &#39;unreasonable&#39;, &#39;upset&#39;,
       &#39;usual&#39;, &#39;uwu&#39;, &#39;value&#39;, &#39;vancouver&#39;, &#39;variety&#39;, &#39;vds&#39;, &#39;ve&#39;,
       &#39;vegan&#39;, &#39;vibe&#39;, &#39;vibes&#39;, &#39;vietnamese&#39;, &#39;view&#39;, &#39;visit&#39;, &#39;wait&#39;,
       &#39;waited&#39;, &#39;waiter&#39;, &#39;waiters&#39;, &#39;waiting&#39;, &#39;waitress&#39;, &#39;walking&#39;,
       &#39;want&#39;, &#39;warm&#39;, &#39;washrooms&#39;, &#39;wasn&#39;, &#39;water&#39;, &#39;watery&#39;, &#39;way&#39;,
       &#39;weekend&#39;, &#39;went&#39;, &#39;wet&#39;, &#39;wife&#39;, &#39;wind&#39;, &#39;window&#39;, &#39;wine&#39;,
       &#39;wings&#39;, &#39;winter&#39;, &#39;work&#39;, &#39;worst&#39;, &#39;wrong&#39;, &#39;yelling&#39;, &#39;yield&#39;,
       &#39;yummy&#39;], dtype=object)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">vocab</span><span class="p">[</span><span class="mi">0</span><span class="p">::</span><span class="mi">20</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([&#39;18&#39;, &#39;ask&#39;, &#39;better&#39;, &#39;cash&#39;, &#39;closing&#39;, &#39;country&#39;, &#39;dessert&#39;,
       &#39;drunk&#39;, &#39;expecting&#39;, &#39;figuring&#39;, &#39;fusion&#39;, &#39;having&#39;, &#39;impeccable&#39;,
       &#39;knowledgeable&#39;, &#39;love&#39;, &#39;nice&#39;, &#39;pain&#39;, &#39;played&#39;, &#39;quality&#39;,
       &#39;removed&#39;, &#39;sauces&#39;, &#39;sitting&#39;, &#39;spoke&#39;, &#39;tacky&#39;, &#39;time&#39;,
       &#39;undressed&#39;, &#39;waited&#39;, &#39;wings&#39;], dtype=object)
</pre></div>
</div>
</div>
</div>
<p><br><br></p>
<p>Do we get better scores if we combine all features? Let’s define a column transformer which carries out</p>
<ul class="simple">
<li><p>imputation and scaling on numeric features</p></li>
<li><p>imputation and one-hot encoding with <code class="docutils literal notranslate"><span class="pre">drop=&quot;if_binary&quot;</span></code> on binary features</p></li>
<li><p>imputation and one-hot encoding with <code class="docutils literal notranslate"><span class="pre">handle_unknown=&quot;ignore&quot;</span></code> on categorical features</p></li>
<li><p>imputation, reshaping, and bag-of-words transformation on the text feature</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.feature_extraction.text</span> <span class="kn">import</span> <span class="n">CountVectorizer</span>
<span class="n">text_feat</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;comments&#39;</span><span class="p">]</span>

<span class="n">preprocessor_all</span> <span class="o">=</span> <span class="n">make_column_transformer</span><span class="p">(</span>
    <span class="p">(</span><span class="n">numeric_transformer</span><span class="p">,</span> <span class="n">numeric_feats</span><span class="p">),</span> 
    <span class="p">(</span><span class="n">binary_transformer</span><span class="p">,</span> <span class="n">binary_feats</span><span class="p">),</span> 
    <span class="p">(</span><span class="n">ordinal_transformer</span><span class="p">,</span> <span class="n">ordinal_feats</span><span class="p">),</span>
    <span class="p">(</span><span class="n">categorical_transformer</span><span class="p">,</span> <span class="n">categorical_feats</span><span class="p">),</span>
    <span class="p">(</span><span class="n">text_transformer</span><span class="p">,</span> <span class="n">text_feat</span><span class="p">),</span> 
    <span class="p">(</span><span class="s2">&quot;drop&quot;</span><span class="p">,</span> <span class="n">drop_feats</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">preprocessor_all</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;753x565 sparse matrix of type &#39;&lt;class &#39;numpy.float64&#39;&gt;&#39;
	with 6927 stored elements in Compressed Sparse Row format&gt;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span> <span class="ow">in</span> <span class="n">models</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">pipe_model</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">text_transformer</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span>
    <span class="n">results_df</span><span class="p">[</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;(text)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mean_std_cross_val_scores</span><span class="p">(</span><span class="n">pipe_model</span><span class="p">,</span> <span class="n">X_train</span><span class="p">[[</span><span class="s1">&#39;comments&#39;</span><span class="p">]],</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">return_train_score</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results_df</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>fit_time</th>
      <th>score_time</th>
      <th>test_score</th>
      <th>train_score</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>dummy</th>
      <td>0.001 (+/- 0.000)</td>
      <td>0.001 (+/- 0.000)</td>
      <td>0.515 (+/- 0.002)</td>
      <td>0.515 (+/- 0.000)</td>
    </tr>
    <tr>
      <th>Decision Tree (numeric-only)</th>
      <td>0.003 (+/- 0.000)</td>
      <td>0.001 (+/- 0.000)</td>
      <td>0.497 (+/- 0.038)</td>
      <td>0.833 (+/- 0.010)</td>
    </tr>
    <tr>
      <th>KNN (numeric-only)</th>
      <td>0.003 (+/- 0.001)</td>
      <td>0.004 (+/- 0.000)</td>
      <td>0.525 (+/- 0.034)</td>
      <td>0.674 (+/- 0.015)</td>
    </tr>
    <tr>
      <th>SVM (numeric-only)</th>
      <td>0.012 (+/- 0.000)</td>
      <td>0.005 (+/- 0.000)</td>
      <td>0.587 (+/- 0.033)</td>
      <td>0.623 (+/- 0.006)</td>
    </tr>
    <tr>
      <th>Decision Tree(non-text feats)</th>
      <td>0.009 (+/- 0.000)</td>
      <td>0.003 (+/- 0.000)</td>
      <td>0.590 (+/- 0.039)</td>
      <td>0.889 (+/- 0.008)</td>
    </tr>
    <tr>
      <th>KNN(non-text feats)</th>
      <td>0.008 (+/- 0.000)</td>
      <td>0.004 (+/- 0.000)</td>
      <td>0.598 (+/- 0.023)</td>
      <td>0.737 (+/- 0.008)</td>
    </tr>
    <tr>
      <th>SVM(non-text feats)</th>
      <td>0.019 (+/- 0.000)</td>
      <td>0.008 (+/- 0.000)</td>
      <td>0.687 (+/- 0.011)</td>
      <td>0.733 (+/- 0.008)</td>
    </tr>
    <tr>
      <th>Decision Tree(text)</th>
      <td>0.008 (+/- 0.001)</td>
      <td>0.001 (+/- 0.000)</td>
      <td>0.618 (+/- 0.036)</td>
      <td>0.735 (+/- 0.004)</td>
    </tr>
    <tr>
      <th>KNN(text)</th>
      <td>0.004 (+/- 0.000)</td>
      <td>0.006 (+/- 0.002)</td>
      <td>0.572 (+/- 0.023)</td>
      <td>0.646 (+/- 0.026)</td>
    </tr>
    <tr>
      <th>SVM(text)</th>
      <td>0.010 (+/- 0.000)</td>
      <td>0.003 (+/- 0.000)</td>
      <td>0.649 (+/- 0.022)</td>
      <td>0.728 (+/- 0.005)</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span> <span class="ow">in</span> <span class="n">models</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">pipe_model</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">preprocessor_all</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span>
    <span class="n">results_df</span><span class="p">[</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;(all)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mean_std_cross_val_scores</span><span class="p">(</span><span class="n">pipe_model</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">return_train_score</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results_df</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>fit_time</th>
      <th>score_time</th>
      <th>test_score</th>
      <th>train_score</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>dummy</th>
      <td>0.001 (+/- 0.000)</td>
      <td>0.001 (+/- 0.000)</td>
      <td>0.515 (+/- 0.002)</td>
      <td>0.515 (+/- 0.000)</td>
    </tr>
    <tr>
      <th>Decision Tree (numeric-only)</th>
      <td>0.003 (+/- 0.000)</td>
      <td>0.001 (+/- 0.000)</td>
      <td>0.497 (+/- 0.038)</td>
      <td>0.833 (+/- 0.010)</td>
    </tr>
    <tr>
      <th>KNN (numeric-only)</th>
      <td>0.003 (+/- 0.001)</td>
      <td>0.004 (+/- 0.000)</td>
      <td>0.525 (+/- 0.034)</td>
      <td>0.674 (+/- 0.015)</td>
    </tr>
    <tr>
      <th>SVM (numeric-only)</th>
      <td>0.012 (+/- 0.000)</td>
      <td>0.005 (+/- 0.000)</td>
      <td>0.587 (+/- 0.033)</td>
      <td>0.623 (+/- 0.006)</td>
    </tr>
    <tr>
      <th>Decision Tree(non-text feats)</th>
      <td>0.009 (+/- 0.000)</td>
      <td>0.003 (+/- 0.000)</td>
      <td>0.590 (+/- 0.039)</td>
      <td>0.889 (+/- 0.008)</td>
    </tr>
    <tr>
      <th>KNN(non-text feats)</th>
      <td>0.008 (+/- 0.000)</td>
      <td>0.004 (+/- 0.000)</td>
      <td>0.598 (+/- 0.023)</td>
      <td>0.737 (+/- 0.008)</td>
    </tr>
    <tr>
      <th>SVM(non-text feats)</th>
      <td>0.019 (+/- 0.000)</td>
      <td>0.008 (+/- 0.000)</td>
      <td>0.687 (+/- 0.011)</td>
      <td>0.733 (+/- 0.008)</td>
    </tr>
    <tr>
      <th>Decision Tree(text)</th>
      <td>0.008 (+/- 0.001)</td>
      <td>0.001 (+/- 0.000)</td>
      <td>0.618 (+/- 0.036)</td>
      <td>0.735 (+/- 0.004)</td>
    </tr>
    <tr>
      <th>KNN(text)</th>
      <td>0.004 (+/- 0.000)</td>
      <td>0.006 (+/- 0.002)</td>
      <td>0.572 (+/- 0.023)</td>
      <td>0.646 (+/- 0.026)</td>
    </tr>
    <tr>
      <th>SVM(text)</th>
      <td>0.010 (+/- 0.000)</td>
      <td>0.003 (+/- 0.000)</td>
      <td>0.649 (+/- 0.022)</td>
      <td>0.728 (+/- 0.005)</td>
    </tr>
    <tr>
      <th>Decision Tree(all)</th>
      <td>0.016 (+/- 0.001)</td>
      <td>0.005 (+/- 0.001)</td>
      <td>0.624 (+/- 0.022)</td>
      <td>0.893 (+/- 0.006)</td>
    </tr>
    <tr>
      <th>KNN(all)</th>
      <td>0.013 (+/- 0.000)</td>
      <td>0.012 (+/- 0.001)</td>
      <td>0.625 (+/- 0.027)</td>
      <td>0.748 (+/- 0.015)</td>
    </tr>
    <tr>
      <th>SVM(all)</th>
      <td>0.023 (+/- 0.000)</td>
      <td>0.008 (+/- 0.001)</td>
      <td>0.699 (+/- 0.017)</td>
      <td>0.786 (+/- 0.008)</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Some improvement when we combine all features!</p>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "571"
        },
        kernelOptions: {
            name: "571",
            path: "./lectures/class_demos"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = '571'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="04_class-demo.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Lecture 4: Class demo</p>
      </div>
    </a>
    <a class="right-next"
       href="08_class-demo.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Lectures 8: Class demo</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#imports-announcements-los">Imports, Announcements, LOs</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#imports">Imports</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#incorporating-text-features-in-the-spotify-dataset">Incorporating text features in the Spotify dataset</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#dummy-model">Dummy model</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#feature-categorization">Feature categorization</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#column-transformer-without-song-title-and-artist-features">Column transformer without <code class="docutils literal notranslate"><span class="pre">song_title</span></code> and <code class="docutils literal notranslate"><span class="pre">artist</span></code> features</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#visualizing-the-transformed-data">Visualizing the transformed data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#building-models">Building models</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#incorporating-song-title-feature">Incorporating “song_title” feature</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#visualizing-the-vocabulary">Visualizing the vocabulary</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#model-building">Model building</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#optional-incorporating-text-features-in-the-restaurant-survey-dataset">(Optional) Incorporating text features in the restaurant survey dataset</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#data-splitting">Data splitting</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#eda">EDA</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#dummy-classifier">Dummy Classifier</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#preprocessing">Preprocessing</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#incorporating-text-features">Incorporating text features</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Varada Kolhatkar
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>